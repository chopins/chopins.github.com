#!/bin/bash

DELETE_LINE=0
while IFS='A ' read -ra LINE;do
DELETE_LINE=$(($DELETE_LINE+1))

case ${LINE[0]} in
  ns1)
continue
  ;;
  ns2)
continue
  ;;
  ns3)
continue
 ;;
ns4)
continue
;;
esac

IP=${LINE[2]}
if [ -z $IP ];then
continue
fi
if [ $IP == 'IN' ];then
continue;
fi

echo -n "$DELETE_LINE : connect $IP"
timeout 5 bash -c "echo >/dev/tcp/$IP/443" >/dev/null 2>&1 && echo " Success" || (bash -c "sed -i '${DELETE_LINE}d' $1";DELETE_LINE=$(($DELETE_LINE-1)); echo -e "\033[1;31m Timeout\033[0m")
wait
done < $1
wait
