// ==UserScript==
// @name         2FA.OTP.TOTP
// @namespace    https://toknot.com/
// @version      2024-06-01
// @description  For 2FA base TOTP
// @author       chopin xiao
// @match        http://127.0.0.1/my2fa.html
// @match        file:///*/my2fa.html
// @match        https://toknot.com/*
// @icon         data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==
// @updateURL    https://toknot.com/download/2fa.meta.js
// @downloadURL https://toknot.com/download/2fa.js
// @grant GM_setValue
// @grant GM_getValue
// @grant GM.setValue
// @grant GM.getValue
// @grant GM_listValues
// @grant GM_deleteValue
// @grant GM_setClipboard
// @run-at document-end
// @copyright   Toknot.com
// ==/UserScript==

//otpauth.umd.min.js
(function (L, P) { typeof exports == "object" && typeof module != "undefined" ? P(exports) : typeof define == "function" && define.amd ? define(["exports"], P) : (L = typeof globalThis != "undefined" ? globalThis : L || self, P(L.OTPAuth = {})) })(this, function (L) { "use strict"; const P = i => { const e = new ArrayBuffer(8), n = new Uint8Array(e); let t = i; for (let r = 7; r >= 0 && t !== 0; r--)n[r] = t & 255, t -= n[r], t /= 256; return e }; var Z = Object.freeze({ __proto__: null, createHmac: void 0, randomBytes: void 0, timingSafeEqual: void 0 }); const W = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"; function _(i, e, n, t) { let r, s, u; const c = e || [0], a = (n = n || 0) >>> 3, f = t === -1 ? 3 : 0; for (r = 0; r < i.length; r += 1)u = r + a, s = u >>> 2, c.length <= s && c.push(0), c[s] |= i[r] << 8 * (f + t * (u % 4)); return { value: c, binLen: 8 * i.length + n } } function F(i, e, n) { switch (e) { case "UTF8": case "UTF16BE": case "UTF16LE": break; default: throw new Error("encoding must be UTF8, UTF16BE, or UTF16LE") }switch (i) { case "HEX": return function (t, r, s) { return function (u, c, a, f) { let d, l, h, g; if (u.length % 2 != 0) throw new Error("String of HEX type must be in byte increments"); const p = c || [0], m = (a = a || 0) >>> 3, A = f === -1 ? 3 : 0; for (d = 0; d < u.length; d += 2) { if (l = parseInt(u.substr(d, 2), 16), isNaN(l)) throw new Error("String of HEX type contains invalid characters"); for (g = (d >>> 1) + m, h = g >>> 2; p.length <= h;)p.push(0); p[h] |= l << 8 * (A + f * (g % 4)) } return { value: p, binLen: 4 * u.length + a } }(t, r, s, n) }; case "TEXT": return function (t, r, s) { return function (u, c, a, f, d) { let l, h, g, p, m, A, b, C, I = 0; const H = a || [0], S = (f = f || 0) >>> 3; if (c === "UTF8") for (b = d === -1 ? 3 : 0, g = 0; g < u.length; g += 1)for (l = u.charCodeAt(g), h = [], 128 > l ? h.push(l) : 2048 > l ? (h.push(192 | l >>> 6), h.push(128 | 63 & l)) : 55296 > l || 57344 <= l ? h.push(224 | l >>> 12, 128 | l >>> 6 & 63, 128 | 63 & l) : (g += 1, l = 65536 + ((1023 & l) << 10 | 1023 & u.charCodeAt(g)), h.push(240 | l >>> 18, 128 | l >>> 12 & 63, 128 | l >>> 6 & 63, 128 | 63 & l)), p = 0; p < h.length; p += 1) { for (A = I + S, m = A >>> 2; H.length <= m;)H.push(0); H[m] |= h[p] << 8 * (b + d * (A % 4)), I += 1 } else for (b = d === -1 ? 2 : 0, C = c === "UTF16LE" && d !== 1 || c !== "UTF16LE" && d === 1, g = 0; g < u.length; g += 1) { for (l = u.charCodeAt(g), C === !0 && (p = 255 & l, l = p << 8 | l >>> 8), A = I + S, m = A >>> 2; H.length <= m;)H.push(0); H[m] |= l << 8 * (b + d * (A % 4)), I += 2 } return { value: H, binLen: 8 * I + f } }(t, e, r, s, n) }; case "B64": return function (t, r, s) { return function (u, c, a, f) { let d, l, h, g, p, m, A, b = 0; const C = c || [0], I = (a = a || 0) >>> 3, H = f === -1 ? 3 : 0, S = u.indexOf("="); if (u.search(/^[a-zA-Z0-9=+/]+$/) === -1) throw new Error("Invalid character in base-64 string"); if (u = u.replace(/=/g, ""), S !== -1 && S < u.length) throw new Error("Invalid '=' found in base-64 string"); for (l = 0; l < u.length; l += 4) { for (p = u.substr(l, 4), g = 0, h = 0; h < p.length; h += 1)d = W.indexOf(p.charAt(h)), g |= d << 18 - 6 * h; for (h = 0; h < p.length - 1; h += 1) { for (A = b + I, m = A >>> 2; C.length <= m;)C.push(0); C[m] |= (g >>> 16 - 8 * h & 255) << 8 * (H + f * (A % 4)), b += 1 } } return { value: C, binLen: 8 * b + a } }(t, r, s, n) }; case "BYTES": return function (t, r, s) { return function (u, c, a, f) { let d, l, h, g; const p = c || [0], m = (a = a || 0) >>> 3, A = f === -1 ? 3 : 0; for (l = 0; l < u.length; l += 1)d = u.charCodeAt(l), g = l + m, h = g >>> 2, p.length <= h && p.push(0), p[h] |= d << 8 * (A + f * (g % 4)); return { value: p, binLen: 8 * u.length + a } }(t, r, s, n) }; case "ARRAYBUFFER": try { new ArrayBuffer(0) } catch (t) { throw new Error("ARRAYBUFFER not supported by this environment") } return function (t, r, s) { return function (u, c, a, f) { return _(new Uint8Array(u), c, a, f) }(t, r, s, n) }; case "UINT8ARRAY": try { new Uint8Array(0) } catch (t) { throw new Error("UINT8ARRAY not supported by this environment") } return function (t, r, s) { return _(t, r, s, n) }; default: throw new Error("format must be HEX, TEXT, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY") } } function ee(i, e, n, t) { switch (i) { case "HEX": return function (r) { return function (s, u, c, a) { const f = "0123456789abcdef"; let d, l, h = ""; const g = u / 8, p = c === -1 ? 3 : 0; for (d = 0; d < g; d += 1)l = s[d >>> 2] >>> 8 * (p + c * (d % 4)), h += f.charAt(l >>> 4 & 15) + f.charAt(15 & l); return a.outputUpper ? h.toUpperCase() : h }(r, e, n, t) }; case "B64": return function (r) { return function (s, u, c, a) { let f, d, l, h, g, p = ""; const m = u / 8, A = c === -1 ? 3 : 0; for (f = 0; f < m; f += 3)for (h = f + 1 < m ? s[f + 1 >>> 2] : 0, g = f + 2 < m ? s[f + 2 >>> 2] : 0, l = (s[f >>> 2] >>> 8 * (A + c * (f % 4)) & 255) << 16 | (h >>> 8 * (A + c * ((f + 1) % 4)) & 255) << 8 | g >>> 8 * (A + c * ((f + 2) % 4)) & 255, d = 0; d < 4; d += 1)p += 8 * f + 6 * d <= u ? W.charAt(l >>> 6 * (3 - d) & 63) : a.b64Pad; return p }(r, e, n, t) }; case "BYTES": return function (r) { return function (s, u, c) { let a, f, d = ""; const l = u / 8, h = c === -1 ? 3 : 0; for (a = 0; a < l; a += 1)f = s[a >>> 2] >>> 8 * (h + c * (a % 4)) & 255, d += String.fromCharCode(f); return d }(r, e, n) }; case "ARRAYBUFFER": try { new ArrayBuffer(0) } catch (r) { throw new Error("ARRAYBUFFER not supported by this environment") } return function (r) { return function (s, u, c) { let a; const f = u / 8, d = new ArrayBuffer(f), l = new Uint8Array(d), h = c === -1 ? 3 : 0; for (a = 0; a < f; a += 1)l[a] = s[a >>> 2] >>> 8 * (h + c * (a % 4)) & 255; return d }(r, e, n) }; case "UINT8ARRAY": try { new Uint8Array(0) } catch (r) { throw new Error("UINT8ARRAY not supported by this environment") } return function (r) { return function (s, u, c) { let a; const f = u / 8, d = c === -1 ? 3 : 0, l = new Uint8Array(f); for (a = 0; a < f; a += 1)l[a] = s[a >>> 2] >>> 8 * (d + c * (a % 4)) & 255; return l }(r, e, n) }; default: throw new Error("format must be HEX, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY") } } const w = [1116352408, 1899447441, 3049323471, 3921009573, 961987163, 1508970993, 2453635748, 2870763221, 3624381080, 310598401, 607225278, 1426881987, 1925078388, 2162078206, 2614888103, 3248222580, 3835390401, 4022224774, 264347078, 604807628, 770255983, 1249150122, 1555081692, 1996064986, 2554220882, 2821834349, 2952996808, 3210313671, 3336571891, 3584528711, 113926993, 338241895, 666307205, 773529912, 1294757372, 1396182291, 1695183700, 1986661051, 2177026350, 2456956037, 2730485921, 2820302411, 3259730800, 3345764771, 3516065817, 3600352804, 4094571909, 275423344, 430227734, 506948616, 659060556, 883997877, 958139571, 1322822218, 1537002063, 1747873779, 1955562222, 2024104815, 2227730452, 2361852424, 2428436474, 2756734187, 3204031479, 3329325298], $ = [3238371032, 914150663, 812702999, 4144912697, 4290775857, 1750603025, 1694076839, 3204075428], B = [1779033703, 3144134277, 1013904242, 2773480762, 1359893119, 2600822924, 528734635, 1541459225], O = "Chosen SHA variant is not supported"; function z(i, e) { let n, t; const r = i.binLen >>> 3, s = e.binLen >>> 3, u = r << 3, c = 4 - r << 3; if (r % 4 != 0) { for (n = 0; n < s; n += 4)t = r + n >>> 2, i.value[t] |= e.value[n >>> 2] << u, i.value.push(0), i.value[t + 1] |= e.value[n >>> 2] >>> c; return (i.value.length << 2) - 4 >= s + r && i.value.pop(), { value: i.value, binLen: i.binLen + e.binLen } } return { value: i.value.concat(e.value), binLen: i.binLen + e.binLen } } function te(i) { const e = { outputUpper: !1, b64Pad: "=", outputLen: -1 }, n = i || {}, t = "Output length must be a multiple of 8"; if (e.outputUpper = n.outputUpper || !1, n.b64Pad && (e.b64Pad = n.b64Pad), n.outputLen) { if (n.outputLen % 8 != 0) throw new Error(t); e.outputLen = n.outputLen } else if (n.shakeLen) { if (n.shakeLen % 8 != 0) throw new Error(t); e.outputLen = n.shakeLen } if (typeof e.outputUpper != "boolean") throw new Error("Invalid outputUpper formatting option"); if (typeof e.b64Pad != "string") throw new Error("Invalid b64Pad formatting option"); return e } function K(i, e, n, t) { const r = i + " must include a value and format"; if (!e) { if (!t) throw new Error(r); return t } if (e.value === void 0 || !e.format) throw new Error(r); return F(e.format, e.encoding || "UTF8", n)(e.value) } let D = class { constructor(e, n, t) { const r = t || {}; if (this.t = n, this.i = r.encoding || "UTF8", this.numRounds = r.numRounds || 1, isNaN(this.numRounds) || this.numRounds !== parseInt(this.numRounds, 10) || 1 > this.numRounds) throw new Error("numRounds must a integer >= 1"); this.o = e, this.h = [], this.u = 0, this.l = !1, this.A = 0, this.H = !1, this.S = [], this.p = [] } update(e) { let n, t = 0; const r = this.m >>> 5, s = this.C(e, this.h, this.u), u = s.binLen, c = s.value, a = u >>> 5; for (n = 0; n < a; n += r)t + this.m <= u && (this.R = this.U(c.slice(n, n + r), this.R), t += this.m); return this.A += t, this.h = c.slice(t >>> 5), this.u = u % this.m, this.l = !0, this } getHash(e, n) { let t, r, s = this.v; const u = te(n); if (this.K) { if (u.outputLen === -1) throw new Error("Output length must be specified in options"); s = u.outputLen } const c = ee(e, s, this.T, u); if (this.H && this.F) return c(this.F(u)); for (r = this.g(this.h.slice(), this.u, this.A, this.B(this.R), s), t = 1; t < this.numRounds; t += 1)this.K && s % 32 != 0 && (r[r.length - 1] &= 16777215 >>> 24 - s % 32), r = this.g(r, s, 0, this.L(this.o), s); return c(r) } setHMACKey(e, n, t) { if (!this.M) throw new Error("Variant does not support HMAC"); if (this.l) throw new Error("Cannot set MAC key after calling update"); const r = F(n, (t || {}).encoding || "UTF8", this.T); this.k(r(e)) } k(e) { const n = this.m >>> 3, t = n / 4 - 1; let r; if (this.numRounds !== 1) throw new Error("Cannot set numRounds with MAC"); if (this.H) throw new Error("MAC key already set"); for (n < e.binLen / 8 && (e.value = this.g(e.value, e.binLen, 0, this.L(this.o), this.v)); e.value.length <= t;)e.value.push(0); for (r = 0; r <= t; r += 1)this.S[r] = 909522486 ^ e.value[r], this.p[r] = 1549556828 ^ e.value[r]; this.R = this.U(this.S, this.R), this.A = this.m, this.H = !0 } getHMAC(e, n) { const t = te(n); return ee(e, this.v, this.T, t)(this.Y()) } Y() { let e; if (!this.H) throw new Error("Cannot call getHMAC without first setting MAC key"); const n = this.g(this.h.slice(), this.u, this.A, this.B(this.R), this.v); return e = this.U(this.p, this.L(this.o)), e = this.g(n, this.v, this.m, e, this.v), e } }; function M(i, e) { return i << e | i >>> 32 - e } function R(i, e) { return i >>> e | i << 32 - e } function ne(i, e) { return i >>> e } function re(i, e, n) { return i ^ e ^ n } function ie(i, e, n) { return i & e ^ ~i & n } function se(i, e, n) { return i & e ^ i & n ^ e & n } function Ae(i) { return R(i, 2) ^ R(i, 13) ^ R(i, 22) } function y(i, e) { const n = (65535 & i) + (65535 & e); return (65535 & (i >>> 16) + (e >>> 16) + (n >>> 16)) << 16 | 65535 & n } function be(i, e, n, t) { const r = (65535 & i) + (65535 & e) + (65535 & n) + (65535 & t); return (65535 & (i >>> 16) + (e >>> 16) + (n >>> 16) + (t >>> 16) + (r >>> 16)) << 16 | 65535 & r } function Y(i, e, n, t, r) { const s = (65535 & i) + (65535 & e) + (65535 & n) + (65535 & t) + (65535 & r); return (65535 & (i >>> 16) + (e >>> 16) + (n >>> 16) + (t >>> 16) + (r >>> 16) + (s >>> 16)) << 16 | 65535 & s } function Ie(i) { return R(i, 7) ^ R(i, 18) ^ ne(i, 3) } function ye(i) { return R(i, 6) ^ R(i, 11) ^ R(i, 25) } function ve(i) { return [1732584193, 4023233417, 2562383102, 271733878, 3285377520] } function oe(i, e) { let n, t, r, s, u, c, a; const f = []; for (n = e[0], t = e[1], r = e[2], s = e[3], u = e[4], a = 0; a < 80; a += 1)f[a] = a < 16 ? i[a] : M(f[a - 3] ^ f[a - 8] ^ f[a - 14] ^ f[a - 16], 1), c = a < 20 ? Y(M(n, 5), ie(t, r, s), u, 1518500249, f[a]) : a < 40 ? Y(M(n, 5), re(t, r, s), u, 1859775393, f[a]) : a < 60 ? Y(M(n, 5), se(t, r, s), u, 2400959708, f[a]) : Y(M(n, 5), re(t, r, s), u, 3395469782, f[a]), u = s, s = r, r = M(t, 30), t = n, n = c; return e[0] = y(n, e[0]), e[1] = y(t, e[1]), e[2] = y(r, e[2]), e[3] = y(s, e[3]), e[4] = y(u, e[4]), e } function Ee(i, e, n, t) { let r; const s = 15 + (e + 65 >>> 9 << 4), u = e + n; for (; i.length <= s;)i.push(0); for (i[e >>> 5] |= 128 << 24 - e % 32, i[s] = 4294967295 & u, i[s - 1] = u / 4294967296 | 0, r = 0; r < i.length; r += 16)t = oe(i.slice(r, r + 16), t); return t } class He extends D { constructor(e, n, t) { if (e !== "SHA-1") throw new Error(O); super(e, n, t); const r = t || {}; this.M = !0, this.F = this.Y, this.T = -1, this.C = F(this.t, this.i, this.T), this.U = oe, this.B = function (s) { return s.slice() }, this.L = ve, this.g = Ee, this.R = [1732584193, 4023233417, 2562383102, 271733878, 3285377520], this.m = 512, this.v = 160, this.K = !1, r.hmacKey && this.k(K("hmacKey", r.hmacKey, this.T)) } } function ue(i) { let e; return e = i == "SHA-224" ? $.slice() : B.slice(), e } function he(i, e) { let n, t, r, s, u, c, a, f, d, l, h; const g = []; for (n = e[0], t = e[1], r = e[2], s = e[3], u = e[4], c = e[5], a = e[6], f = e[7], h = 0; h < 64; h += 1)g[h] = h < 16 ? i[h] : be(R(p = g[h - 2], 17) ^ R(p, 19) ^ ne(p, 10), g[h - 7], Ie(g[h - 15]), g[h - 16]), d = Y(f, ye(u), ie(u, c, a), w[h], g[h]), l = y(Ae(n), se(n, t, r)), f = a, a = c, c = u, u = y(s, d), s = r, r = t, t = n, n = y(d, l); var p; return e[0] = y(n, e[0]), e[1] = y(t, e[1]), e[2] = y(r, e[2]), e[3] = y(s, e[3]), e[4] = y(u, e[4]), e[5] = y(c, e[5]), e[6] = y(a, e[6]), e[7] = y(f, e[7]), e } class Ne extends D { constructor(e, n, t) { if (e !== "SHA-224" && e !== "SHA-256") throw new Error(O); super(e, n, t); const r = t || {}; this.F = this.Y, this.M = !0, this.T = -1, this.C = F(this.t, this.i, this.T), this.U = he, this.B = function (s) { return s.slice() }, this.L = ue, this.g = function (s, u, c, a) { return function (f, d, l, h, g) { let p, m; const A = 15 + (d + 65 >>> 9 << 4), b = d + l; for (; f.length <= A;)f.push(0); for (f[d >>> 5] |= 128 << 24 - d % 32, f[A] = 4294967295 & b, f[A - 1] = b / 4294967296 | 0, p = 0; p < f.length; p += 16)h = he(f.slice(p, p + 16), h); return m = g === "SHA-224" ? [h[0], h[1], h[2], h[3], h[4], h[5], h[6]] : h, m }(s, u, c, a, e) }, this.R = ue(e), this.m = 512, this.v = e === "SHA-224" ? 224 : 256, this.K = !1, r.hmacKey && this.k(K("hmacKey", r.hmacKey, this.T)) } } class o { constructor(e, n) { this.N = e, this.I = n } } function ae(i, e) { let n; return e > 32 ? (n = 64 - e, new o(i.I << e | i.N >>> n, i.N << e | i.I >>> n)) : e !== 0 ? (n = 32 - e, new o(i.N << e | i.I >>> n, i.I << e | i.N >>> n)) : i } function T(i, e) { let n; return e < 32 ? (n = 32 - e, new o(i.N >>> e | i.I << n, i.I >>> e | i.N << n)) : (n = 64 - e, new o(i.I >>> e | i.N << n, i.N >>> e | i.I << n)) } function ce(i, e) { return new o(i.N >>> e, i.I >>> e | i.N << 32 - e) } function Se(i, e, n) { return new o(i.N & e.N ^ i.N & n.N ^ e.N & n.N, i.I & e.I ^ i.I & n.I ^ e.I & n.I) } function Re(i) { const e = T(i, 28), n = T(i, 34), t = T(i, 39); return new o(e.N ^ n.N ^ t.N, e.I ^ n.I ^ t.I) } function N(i, e) { let n, t; n = (65535 & i.I) + (65535 & e.I), t = (i.I >>> 16) + (e.I >>> 16) + (n >>> 16); const r = (65535 & t) << 16 | 65535 & n; return n = (65535 & i.N) + (65535 & e.N) + (t >>> 16), t = (i.N >>> 16) + (e.N >>> 16) + (n >>> 16), new o((65535 & t) << 16 | 65535 & n, r) } function Te(i, e, n, t) { let r, s; r = (65535 & i.I) + (65535 & e.I) + (65535 & n.I) + (65535 & t.I), s = (i.I >>> 16) + (e.I >>> 16) + (n.I >>> 16) + (t.I >>> 16) + (r >>> 16); const u = (65535 & s) << 16 | 65535 & r; return r = (65535 & i.N) + (65535 & e.N) + (65535 & n.N) + (65535 & t.N) + (s >>> 16), s = (i.N >>> 16) + (e.N >>> 16) + (n.N >>> 16) + (t.N >>> 16) + (r >>> 16), new o((65535 & s) << 16 | 65535 & r, u) } function Ue(i, e, n, t, r) { let s, u; s = (65535 & i.I) + (65535 & e.I) + (65535 & n.I) + (65535 & t.I) + (65535 & r.I), u = (i.I >>> 16) + (e.I >>> 16) + (n.I >>> 16) + (t.I >>> 16) + (r.I >>> 16) + (s >>> 16); const c = (65535 & u) << 16 | 65535 & s; return s = (65535 & i.N) + (65535 & e.N) + (65535 & n.N) + (65535 & t.N) + (65535 & r.N) + (u >>> 16), u = (i.N >>> 16) + (e.N >>> 16) + (n.N >>> 16) + (t.N >>> 16) + (r.N >>> 16) + (s >>> 16), new o((65535 & u) << 16 | 65535 & s, c) } function x(i, e) { return new o(i.N ^ e.N, i.I ^ e.I) } function Ce(i) { const e = T(i, 19), n = T(i, 61), t = ce(i, 6); return new o(e.N ^ n.N ^ t.N, e.I ^ n.I ^ t.I) } function Le(i) { const e = T(i, 1), n = T(i, 8), t = ce(i, 7); return new o(e.N ^ n.N ^ t.N, e.I ^ n.I ^ t.I) } function $e(i) { const e = T(i, 14), n = T(i, 18), t = T(i, 41); return new o(e.N ^ n.N ^ t.N, e.I ^ n.I ^ t.I) } const Be = [new o(w[0], 3609767458), new o(w[1], 602891725), new o(w[2], 3964484399), new o(w[3], 2173295548), new o(w[4], 4081628472), new o(w[5], 3053834265), new o(w[6], 2937671579), new o(w[7], 3664609560), new o(w[8], 2734883394), new o(w[9], 1164996542), new o(w[10], 1323610764), new o(w[11], 3590304994), new o(w[12], 4068182383), new o(w[13], 991336113), new o(w[14], 633803317), new o(w[15], 3479774868), new o(w[16], 2666613458), new o(w[17], 944711139), new o(w[18], 2341262773), new o(w[19], 2007800933), new o(w[20], 1495990901), new o(w[21], 1856431235), new o(w[22], 3175218132), new o(w[23], 2198950837), new o(w[24], 3999719339), new o(w[25], 766784016), new o(w[26], 2566594879), new o(w[27], 3203337956), new o(w[28], 1034457026), new o(w[29], 2466948901), new o(w[30], 3758326383), new o(w[31], 168717936), new o(w[32], 1188179964), new o(w[33], 1546045734), new o(w[34], 1522805485), new o(w[35], 2643833823), new o(w[36], 2343527390), new o(w[37], 1014477480), new o(w[38], 1206759142), new o(w[39], 344077627), new o(w[40], 1290863460), new o(w[41], 3158454273), new o(w[42], 3505952657), new o(w[43], 106217008), new o(w[44], 3606008344), new o(w[45], 1432725776), new o(w[46], 1467031594), new o(w[47], 851169720), new o(w[48], 3100823752), new o(w[49], 1363258195), new o(w[50], 3750685593), new o(w[51], 3785050280), new o(w[52], 3318307427), new o(w[53], 3812723403), new o(w[54], 2003034995), new o(w[55], 3602036899), new o(w[56], 1575990012), new o(w[57], 1125592928), new o(w[58], 2716904306), new o(w[59], 442776044), new o(w[60], 593698344), new o(w[61], 3733110249), new o(w[62], 2999351573), new o(w[63], 3815920427), new o(3391569614, 3928383900), new o(3515267271, 566280711), new o(3940187606, 3454069534), new o(4118630271, 4000239992), new o(116418474, 1914138554), new o(174292421, 2731055270), new o(289380356, 3203993006), new o(460393269, 320620315), new o(685471733, 587496836), new o(852142971, 1086792851), new o(1017036298, 365543100), new o(1126000580, 2618297676), new o(1288033470, 3409855158), new o(1501505948, 4234509866), new o(1607167915, 987167468), new o(1816402316, 1246189591)]; function fe(i) { return i === "SHA-384" ? [new o(3418070365, $[0]), new o(1654270250, $[1]), new o(2438529370, $[2]), new o(355462360, $[3]), new o(1731405415, $[4]), new o(41048885895, $[5]), new o(3675008525, $[6]), new o(1203062813, $[7])] : [new o(B[0], 4089235720), new o(B[1], 2227873595), new o(B[2], 4271175723), new o(B[3], 1595750129), new o(B[4], 2917565137), new o(B[5], 725511199), new o(B[6], 4215389547), new o(B[7], 327033209)] } function le(i, e) { let n, t, r, s, u, c, a, f, d, l, h, g; const p = []; for (n = e[0], t = e[1], r = e[2], s = e[3], u = e[4], c = e[5], a = e[6], f = e[7], h = 0; h < 80; h += 1)h < 16 ? (g = 2 * h, p[h] = new o(i[g], i[g + 1])) : p[h] = Te(Ce(p[h - 2]), p[h - 7], Le(p[h - 15]), p[h - 16]), d = Ue(f, $e(u), (A = c, b = a, new o((m = u).N & A.N ^ ~m.N & b.N, m.I & A.I ^ ~m.I & b.I)), Be[h], p[h]), l = N(Re(n), Se(n, t, r)), f = a, a = c, c = u, u = N(s, d), s = r, r = t, t = n, n = N(d, l); var m, A, b; return e[0] = N(n, e[0]), e[1] = N(t, e[1]), e[2] = N(r, e[2]), e[3] = N(s, e[3]), e[4] = N(u, e[4]), e[5] = N(c, e[5]), e[6] = N(a, e[6]), e[7] = N(f, e[7]), e } class Ke extends D { constructor(e, n, t) { if (e !== "SHA-384" && e !== "SHA-512") throw new Error(O); super(e, n, t); const r = t || {}; this.F = this.Y, this.M = !0, this.T = -1, this.C = F(this.t, this.i, this.T), this.U = le, this.B = function (s) { return s.slice() }, this.L = fe, this.g = function (s, u, c, a) { return function (f, d, l, h, g) { let p, m; const A = 31 + (d + 129 >>> 10 << 5), b = d + l; for (; f.length <= A;)f.push(0); for (f[d >>> 5] |= 128 << 24 - d % 32, f[A] = 4294967295 & b, f[A - 1] = b / 4294967296 | 0, p = 0; p < f.length; p += 32)h = le(f.slice(p, p + 32), h); return m = g === "SHA-384" ? [h[0].N, h[0].I, h[1].N, h[1].I, h[2].N, h[2].I, h[3].N, h[3].I, h[4].N, h[4].I, h[5].N, h[5].I] : [h[0].N, h[0].I, h[1].N, h[1].I, h[2].N, h[2].I, h[3].N, h[3].I, h[4].N, h[4].I, h[5].N, h[5].I, h[6].N, h[6].I, h[7].N, h[7].I], m }(s, u, c, a, e) }, this.R = fe(e), this.m = 1024, this.v = e === "SHA-384" ? 384 : 512, this.K = !1, r.hmacKey && this.k(K("hmacKey", r.hmacKey, this.T)) } } const Fe = [new o(0, 1), new o(0, 32898), new o(2147483648, 32906), new o(2147483648, 2147516416), new o(0, 32907), new o(0, 2147483649), new o(2147483648, 2147516545), new o(2147483648, 32777), new o(0, 138), new o(0, 136), new o(0, 2147516425), new o(0, 2147483658), new o(0, 2147516555), new o(2147483648, 139), new o(2147483648, 32905), new o(2147483648, 32771), new o(2147483648, 32770), new o(2147483648, 128), new o(0, 32778), new o(2147483648, 2147483658), new o(2147483648, 2147516545), new o(2147483648, 32896), new o(0, 2147483649), new o(2147483648, 2147516424)], Me = [[0, 36, 3, 41, 18], [1, 44, 10, 45, 2], [62, 6, 43, 15, 61], [28, 55, 25, 21, 56], [27, 20, 39, 8, 14]]; function V(i) { let e; const n = []; for (e = 0; e < 5; e += 1)n[e] = [new o(0, 0), new o(0, 0), new o(0, 0), new o(0, 0), new o(0, 0)]; return n } function ke(i) { let e; const n = []; for (e = 0; e < 5; e += 1)n[e] = i[e].slice(); return n } function q(i, e) { let n, t, r, s; const u = [], c = []; if (i !== null) for (t = 0; t < i.length; t += 2)e[(t >>> 1) % 5][(t >>> 1) / 5 | 0] = x(e[(t >>> 1) % 5][(t >>> 1) / 5 | 0], new o(i[t + 1], i[t])); for (n = 0; n < 24; n += 1) { for (s = V(), t = 0; t < 5; t += 1)u[t] = (a = e[t][0], f = e[t][1], d = e[t][2], l = e[t][3], h = e[t][4], new o(a.N ^ f.N ^ d.N ^ l.N ^ h.N, a.I ^ f.I ^ d.I ^ l.I ^ h.I)); for (t = 0; t < 5; t += 1)c[t] = x(u[(t + 4) % 5], ae(u[(t + 1) % 5], 1)); for (t = 0; t < 5; t += 1)for (r = 0; r < 5; r += 1)e[t][r] = x(e[t][r], c[t]); for (t = 0; t < 5; t += 1)for (r = 0; r < 5; r += 1)s[r][(2 * t + 3 * r) % 5] = ae(e[t][r], Me[t][r]); for (t = 0; t < 5; t += 1)for (r = 0; r < 5; r += 1)e[t][r] = x(s[t][r], new o(~s[(t + 1) % 5][r].N & s[(t + 2) % 5][r].N, ~s[(t + 1) % 5][r].I & s[(t + 2) % 5][r].I)); e[0][0] = x(e[0][0], Fe[n]) } var a, f, d, l, h; return e } function we(i) { let e, n, t = 0; const r = [0, 0], s = [4294967295 & i, i / 4294967296 & 2097151]; for (e = 6; e >= 0; e--)n = s[e >> 2] >>> 8 * e & 255, n === 0 && t === 0 || (r[t + 1 >> 2] |= n << 8 * (t + 1), t += 1); return t = t !== 0 ? t : 1, r[0] |= t, { value: t + 1 > 4 ? r : [r[0]], binLen: 8 + 8 * t } } function J(i) { return z(we(i.binLen), i) } function de(i, e) { let n, t = we(e); t = z(t, i); const r = e >>> 2, s = (r - t.value.length % r) % r; for (n = 0; n < s; n++)t.value.push(0); return t.value } class Pe extends D { constructor(e, n, t) { let r = 6, s = 0; super(e, n, t); const u = t || {}; if (this.numRounds !== 1) { if (u.kmacKey || u.hmacKey) throw new Error("Cannot set numRounds with MAC"); if (this.o === "CSHAKE128" || this.o === "CSHAKE256") throw new Error("Cannot set numRounds for CSHAKE variants") } switch (this.T = 1, this.C = F(this.t, this.i, this.T), this.U = q, this.B = ke, this.L = V, this.R = V(), this.K = !1, e) { case "SHA3-224": this.m = s = 1152, this.v = 224, this.M = !0, this.F = this.Y; break; case "SHA3-256": this.m = s = 1088, this.v = 256, this.M = !0, this.F = this.Y; break; case "SHA3-384": this.m = s = 832, this.v = 384, this.M = !0, this.F = this.Y; break; case "SHA3-512": this.m = s = 576, this.v = 512, this.M = !0, this.F = this.Y; break; case "SHAKE128": r = 31, this.m = s = 1344, this.v = -1, this.K = !0, this.M = !1, this.F = null; break; case "SHAKE256": r = 31, this.m = s = 1088, this.v = -1, this.K = !0, this.M = !1, this.F = null; break; case "KMAC128": r = 4, this.m = s = 1344, this.X(t), this.v = -1, this.K = !0, this.M = !1, this.F = this._; break; case "KMAC256": r = 4, this.m = s = 1088, this.X(t), this.v = -1, this.K = !0, this.M = !1, this.F = this._; break; case "CSHAKE128": this.m = s = 1344, r = this.O(t), this.v = -1, this.K = !0, this.M = !1, this.F = null; break; case "CSHAKE256": this.m = s = 1088, r = this.O(t), this.v = -1, this.K = !0, this.M = !1, this.F = null; break; default: throw new Error(O) }this.g = function (c, a, f, d, l) { return function (h, g, p, m, A, b, C) { let I, H, S = 0; const j = [], G = A >>> 5, st = g >>> 5; for (I = 0; I < st && g >= A; I += G)m = q(h.slice(I, I + G), m), g -= A; for (h = h.slice(I), g %= A; h.length < G;)h.push(0); for (I = g >>> 3, h[I >> 2] ^= b << I % 4 * 8, h[G - 1] ^= 2147483648, m = q(h, m); 32 * j.length < C && (H = m[S % 5][S / 5 | 0], j.push(H.I), !(32 * j.length >= C));)j.push(H.N), S += 1, 64 * S % A == 0 && (q(null, m), S = 0); return j }(c, a, 0, d, s, r, l) }, u.hmacKey && this.k(K("hmacKey", u.hmacKey, this.T)) } O(e, n) { const t = function (s) { const u = s || {}; return { funcName: K("funcName", u.funcName, 1, { value: [], binLen: 0 }), customization: K("Customization", u.customization, 1, { value: [], binLen: 0 }) } }(e || {}); n && (t.funcName = n); const r = z(J(t.funcName), J(t.customization)); if (t.customization.binLen !== 0 || t.funcName.binLen !== 0) { const s = de(r, this.m >>> 3); for (let u = 0; u < s.length; u += this.m >>> 5)this.R = this.U(s.slice(u, u + (this.m >>> 5)), this.R), this.A += this.m; return 4 } return 31 } X(e) { const n = function (r) { const s = r || {}; return { kmacKey: K("kmacKey", s.kmacKey, 1), funcName: { value: [1128353099], binLen: 32 }, customization: K("Customization", s.customization, 1, { value: [], binLen: 0 }) } }(e || {}); this.O(e, n.funcName); const t = de(J(n.kmacKey), this.m >>> 3); for (let r = 0; r < t.length; r += this.m >>> 5)this.R = this.U(t.slice(r, r + (this.m >>> 5)), this.R), this.A += this.m; this.H = !0 } _(e) { const n = z({ value: this.h.slice(), binLen: this.u }, function (t) { let r, s, u = 0; const c = [0, 0], a = [4294967295 & t, t / 4294967296 & 2097151]; for (r = 6; r >= 0; r--)s = a[r >> 2] >>> 8 * r & 255, s === 0 && u === 0 || (c[u >> 2] |= s << 8 * u, u += 1); return u = u !== 0 ? u : 1, c[u >> 2] |= u << 8 * u, { value: u + 1 > 4 ? c : [c[0]], binLen: 8 + 8 * u } }(e.outputLen)); return this.g(n.value, n.binLen, this.A, this.B(this.R), e.outputLen) } } class Oe { constructor(e, n, t) { if (e == "SHA-1") this.P = new He(e, n, t); else if (e == "SHA-224" || e == "SHA-256") this.P = new Ne(e, n, t); else if (e == "SHA-384" || e == "SHA-512") this.P = new Ke(e, n, t); else { if (e != "SHA3-224" && e != "SHA3-256" && e != "SHA3-384" && e != "SHA3-512" && e != "SHAKE128" && e != "SHAKE256" && e != "CSHAKE128" && e != "CSHAKE256" && e != "KMAC128" && e != "KMAC256") throw new Error(O); this.P = new Pe(e, n, t) } } update(e) { return this.P.update(e), this } getHash(e, n) { return this.P.getHash(e, n) } setHMACKey(e, n, t) { this.P.setHMACKey(e, n, t) } getHMAC(e, n) { return this.P.getHMAC(e, n) } } const k = (() => { if (typeof globalThis == "object") return globalThis; Object.defineProperty(Object.prototype, "__GLOBALTHIS__", { get() { return this }, configurable: !0 }); try { if (typeof __GLOBALTHIS__ != "undefined") return __GLOBALTHIS__ } finally { delete Object.prototype.__GLOBALTHIS__ } if (typeof self != "undefined") return self; if (typeof window != "undefined") return window; if (typeof global != "undefined") return global })(), Ye = { SHA1: "SHA-1", SHA224: "SHA-224", SHA256: "SHA-256", SHA384: "SHA-384", SHA512: "SHA-512", "SHA3-224": "SHA3-224", "SHA3-256": "SHA3-256", "SHA3-384": "SHA3-384", "SHA3-512": "SHA3-512" }, xe = (i, e, n) => { Z != null; { const t = Ye[i.toUpperCase()]; if (typeof t == "undefined") throw new TypeError("Unknown hash function"); const r = new Oe(t, "ARRAYBUFFER"); return r.setHMACKey(e, "ARRAYBUFFER"), r.update(n), r.getHMAC("ARRAYBUFFER") } }, Q = "ABCDEFGHIJKLMNOPQRSTUVWXYZ234567", Xe = i => { let e = i.length; for (; i[e - 1] === "=";)--e; const n = (e < i.length ? i.substring(0, e) : i).toUpperCase(), t = new ArrayBuffer(n.length * 5 / 8 | 0), r = new Uint8Array(t); let s = 0, u = 0, c = 0; for (let a = 0; a < n.length; a++) { const f = Q.indexOf(n[a]); if (f === -1) throw new TypeError(`Invalid character found: ${n[a]}`); u = u << 5 | f, s += 5, s >= 8 && (s -= 8, r[c++] = u >>> s) } return t }, je = i => { const e = new Uint8Array(i); let n = 0, t = 0, r = ""; for (let s = 0; s < e.length; s++)for (t = t << 8 | e[s], n += 8; n >= 5;)r += Q[t >>> n - 5 & 31], n -= 5; return n > 0 && (r += Q[t << 5 - n & 31]), r }, ze = i => { const e = new ArrayBuffer(i.length / 2), n = new Uint8Array(e); for (let t = 0; t < i.length; t += 2)n[t / 2] = parseInt(i.substring(t, t + 2), 16); return e }, De = i => { const e = new Uint8Array(i); let n = ""; for (let t = 0; t < e.length; t++) { const r = e[t].toString(16); r.length === 1 && (n += "0"), n += r } return n.toUpperCase() }, qe = i => { const e = new ArrayBuffer(i.length), n = new Uint8Array(e); for (let t = 0; t < i.length; t++)n[t] = i.charCodeAt(t) & 255; return e }, Ge = i => { const e = new Uint8Array(i); let n = ""; for (let t = 0; t < e.length; t++)n += String.fromCharCode(e[t]); return n }, ge = k.TextEncoder ? new k.TextEncoder("utf-8") : null, pe = k.TextDecoder ? new k.TextDecoder("utf-8") : null, Ze = i => { if (!ge) throw new Error("Encoding API not available"); return ge.encode(i).buffer }, Ve = i => { if (!pe) throw new Error("Encoding API not available"); return pe.decode(i) }, Je = i => { var e; if (Z != null, !((e = k.crypto) != null && e.getRandomValues)) throw new Error("Cryptography API not available"); return k.crypto.getRandomValues(new Uint8Array(i)).buffer }; class U { constructor({ buffer: e, size: n = 20 } = {}) { this.buffer = typeof e == "undefined" ? Je(n) : e } static fromLatin1(e) { return new U({ buffer: qe(e) }) } static fromUTF8(e) { return new U({ buffer: Ze(e) }) } static fromBase32(e) { return new U({ buffer: Xe(e) }) } static fromHex(e) { return new U({ buffer: ze(e) }) } get latin1() { return Object.defineProperty(this, "latin1", { enumerable: !0, value: Ge(this.buffer) }), this.latin1 } get utf8() { return Object.defineProperty(this, "utf8", { enumerable: !0, value: Ve(this.buffer) }), this.utf8 } get base32() { return Object.defineProperty(this, "base32", { enumerable: !0, value: je(this.buffer) }), this.base32 } get hex() { return Object.defineProperty(this, "hex", { enumerable: !0, value: De(this.buffer) }), this.hex } } const Qe = (i, e) => { Z != null; { if (i.length !== e.length) throw new TypeError("Input strings must have the same length"); let n = -1, t = 0; for (; ++n < i.length;)t |= i.charCodeAt(n) ^ e.charCodeAt(n); return t === 0 } }; var We = Math.pow; let X = class v { static get defaults() { return { issuer: "", label: "OTPAuth", algorithm: "SHA1", digits: 6, counter: 0, window: 1 } } constructor({ issuer: e = v.defaults.issuer, label: n = v.defaults.label, secret: t = new U, algorithm: r = v.defaults.algorithm, digits: s = v.defaults.digits, counter: u = v.defaults.counter } = {}) { this.issuer = e, this.label = n, this.secret = typeof t == "string" ? U.fromBase32(t) : t, this.algorithm = r.toUpperCase(), this.digits = s, this.counter = u } static generate({ secret: e, algorithm: n = v.defaults.algorithm, digits: t = v.defaults.digits, counter: r = v.defaults.counter }) { const s = new Uint8Array(xe(n, e.buffer, P(r))), u = s[s.byteLength - 1] & 15; return (((s[u] & 127) << 24 | (s[u + 1] & 255) << 16 | (s[u + 2] & 255) << 8 | s[u + 3] & 255) % We(10, t)).toString().padStart(t, "0") } generate({ counter: e = this.counter++ } = {}) { return v.generate({ secret: this.secret, algorithm: this.algorithm, digits: this.digits, counter: e }) } static validate({ token: e, secret: n, algorithm: t, digits: r, counter: s = v.defaults.counter, window: u = v.defaults.window }) { if (e.length !== r) return null; let c = null; for (let a = s - u; a <= s + u; ++a) { const f = v.generate({ secret: n, algorithm: t, digits: r, counter: a }); Qe(e, f) && (c = a - s) } return c } validate({ token: e, counter: n = this.counter, window: t }) { return v.validate({ token: e, secret: this.secret, algorithm: this.algorithm, digits: this.digits, counter: n, window: t }) } toString() { const e = encodeURIComponent; return `otpauth://hotp/${this.issuer.length > 0 ? `${e(this.issuer)}:${e(this.label)}?issuer=${e(this.issuer)}&` : `${e(this.label)}?`}secret=${e(this.secret.base32)}&algorithm=${e(this.algorithm)}&digits=${e(this.digits)}&counter=${e(this.counter)}` } }; class E { static get defaults() { return { issuer: "", label: "OTPAuth", algorithm: "SHA1", digits: 6, period: 30, window: 1 } } constructor({ issuer: e = E.defaults.issuer, label: n = E.defaults.label, secret: t = new U, algorithm: r = E.defaults.algorithm, digits: s = E.defaults.digits, period: u = E.defaults.period } = {}) { this.issuer = e, this.label = n, this.secret = typeof t == "string" ? U.fromBase32(t) : t, this.algorithm = r.toUpperCase(), this.digits = s, this.period = u } static generate({ secret: e, algorithm: n, digits: t, period: r = E.defaults.period, timestamp: s = Date.now() }) { return X.generate({ secret: e, algorithm: n, digits: t, counter: Math.floor(s / 1e3 / r) }) } generate({ timestamp: e = Date.now() } = {}) { return E.generate({ secret: this.secret, algorithm: this.algorithm, digits: this.digits, period: this.period, timestamp: e }) } static validate({ token: e, secret: n, algorithm: t, digits: r, period: s = E.defaults.period, timestamp: u = Date.now(), window: c }) { return X.validate({ token: e, secret: n, algorithm: t, digits: r, counter: Math.floor(u / 1e3 / s), window: c }) } validate({ token: e, timestamp: n, window: t }) { return E.validate({ token: e, secret: this.secret, algorithm: this.algorithm, digits: this.digits, period: this.period, timestamp: n, window: t }) } toString() { const e = encodeURIComponent; return `otpauth://totp/${this.issuer.length > 0 ? `${e(this.issuer)}:${e(this.label)}?issuer=${e(this.issuer)}&` : `${e(this.label)}?`}secret=${e(this.secret.base32)}&algorithm=${e(this.algorithm)}&digits=${e(this.digits)}&period=${e(this.period)}` } } const _e = /^otpauth:\/\/([ht]otp)\/(.+)\?([A-Z0-9.~_-]+=[^?&]*(?:&[A-Z0-9.~_-]+=[^?&]*)*)$/i, et = /^[2-7A-Z]+=*$/i, tt = /^SHA(?:1|224|256|384|512|3-224|3-256|3-384|3-512)$/i, nt = /^[+-]?\d+$/, me = /^\+?[1-9]\d*$/; class rt { static parse(e) { let n; try { n = e.match(_e) } catch (a) { } if (!Array.isArray(n)) throw new URIError("Invalid URI format"); const t = n[1].toLowerCase(), r = n[2].split(/(?::|%3A) *(.+)/i, 2).map(decodeURIComponent), s = n[3].split("&").reduce((a, f) => { const d = f.split(/=(.*)/, 2).map(decodeURIComponent), l = d[0].toLowerCase(), h = d[1], g = a; return g[l] = h, g }, {}); let u; const c = {}; if (t === "hotp") if (u = X, typeof s.counter != "undefined" && nt.test(s.counter)) c.counter = parseInt(s.counter, 10); else throw new TypeError("Missing or invalid 'counter' parameter"); else if (t === "totp") { if (u = E, typeof s.period != "undefined") if (me.test(s.period)) c.period = parseInt(s.period, 10); else throw new TypeError("Invalid 'period' parameter") } else throw new TypeError("Unknown OTP type"); if (r.length === 2 ? (c.label = r[1], c.issuer = r[0]) : (c.label = r[0], typeof s.issuer != "undefined" && (c.issuer = s.issuer)), typeof s.secret != "undefined" && et.test(s.secret)) c.secret = s.secret; else throw new TypeError("Missing or invalid 'secret' parameter"); if (typeof s.algorithm != "undefined") if (tt.test(s.algorithm)) c.algorithm = s.algorithm; else throw new TypeError("Invalid 'algorithm' parameter"); if (typeof s.digits != "undefined") if (me.test(s.digits)) c.digits = parseInt(s.digits, 10); else throw new TypeError("Invalid 'digits' parameter"); return new u(c) } static stringify(e) { if (e instanceof X || e instanceof E) return e.toString(); throw new TypeError("Invalid 'HOTP/TOTP' object") } } const it = "9.1.4"; L.HOTP = X, L.Secret = U, L.TOTP = E, L.URI = rt, L.version = it });

//llqrcode.js
var _aa = {}; _aa._ab = function (f, e) { var d = qrcode.width; var b = qrcode.height; var c = true; for (var g = 0; g < e.length && c; g += 2) { var a = Math.floor(e[g]); var h = Math.floor(e[g + 1]); if (a < -1 || a > d || h < -1 || h > b) { throw "Error._ab " } c = false; if (a == -1) { e[g] = 0; c = true } else { if (a == d) { e[g] = d - 1; c = true } } if (h == -1) { e[g + 1] = 0; c = true } else { if (h == b) { e[g + 1] = b - 1; c = true } } } c = true; for (var g = e.length - 2; g >= 0 && c; g -= 2) { var a = Math.floor(e[g]); var h = Math.floor(e[g + 1]); if (a < -1 || a > d || h < -1 || h > b) { throw "Error._ab " } c = false; if (a == -1) { e[g] = 0; c = true } else { if (a == d) { e[g] = d - 1; c = true } } if (h == -1) { e[g + 1] = 0; c = true } else { if (h == b) { e[g + 1] = b - 1; c = true } } } }; _aa._af = function (b, d, a) { var k = new _ac(d); var j = new Array(d << 1); for (var f = 0; f < d; f++) { var g = j.length; var i = f + 0.5; for (var h = 0; h < g; h += 2) { j[h] = (h >> 1) + 0.5; j[h + 1] = i } a._ad(j); _aa._ab(b, j); try { for (var h = 0; h < g; h += 2) { var e = b[Math.floor(j[h]) + qrcode.width * Math.floor(j[h + 1])]; if (e) { k._dq(h >> 1, f) } } } catch (c) { throw "Error._ab" } } return k }; _aa._ah = function (h, o, l, k, q, p, b, a, f, e, n, m, s, r, d, c, j, i) { var g = _ae._ag(l, k, q, p, b, a, f, e, n, m, s, r, d, c, j, i); return _aa._af(h, o, g) }; function _a1(b, a) { this.count = b; this._fc = a; this.__defineGetter__("Count", function () { return this.count }); this.__defineGetter__("_dm", function () { return this._fc }) } function _a2(a, c, b) { this._bm = a; if (b) { this._do = new Array(c, b) } else { this._do = new Array(c) } this.__defineGetter__("_bo", function () { return this._bm }); this.__defineGetter__("_dn", function () { return this._bm * this._fo }); this.__defineGetter__("_fo", function () { var e = 0; for (var d = 0; d < this._do.length; d++) { e += this._do[d].length } return e }); this._fb = function () { return this._do } } function _a3(k, l, h, g, f, e) { this._bs = k; this._ar = l; this._do = new Array(h, g, f, e); var j = 0; var b = h._bo; var a = h._fb(); for (var d = 0; d < a.length; d++) { var c = a[d]; j += c.Count * (c._dm + b) } this._br = j; this.__defineGetter__("_fd", function () { return this._bs }); this.__defineGetter__("_as", function () { return this._ar }); this.__defineGetter__("_dp", function () { return this._br }); this.__defineGetter__("_cr", function () { return 17 + 4 * this._bs }); this._aq = function () { var q = this._cr; var o = new _ac(q); o._bq(0, 0, 9, 9); o._bq(q - 8, 0, 8, 9); o._bq(0, q - 8, 9, 8); var n = this._ar.length; for (var m = 0; m < n; m++) { var p = this._ar[m] - 2; for (var r = 0; r < n; r++) { if ((m == 0 && (r == 0 || r == n - 1)) || (m == n - 1 && r == 0)) { continue } o._bq(this._ar[r] - 2, p, 5, 5) } } o._bq(6, 9, 1, q - 17); o._bq(9, 6, q - 17, 1); if (this._bs > 6) { o._bq(q - 11, 0, 3, 6); o._bq(0, q - 11, 6, 3) } return o }; this._bu = function (i) { return this._do[i.ordinal()] } } _a3._bv = new Array(31892, 34236, 39577, 42195, 48118, 51042, 55367, 58893, 63784, 68472, 70749, 76311, 79154, 84390, 87683, 92361, 96236, 102084, 102881, 110507, 110734, 117786, 119615, 126325, 127568, 133589, 136944, 141498, 145311, 150283, 152622, 158308, 161089, 167017); _a3.VERSIONS = _ay(); _a3._av = function (a) { if (a < 1 || a > 40) { throw "bad arguments" } return _a3.VERSIONS[a - 1] }; _a3._at = function (b) { if (b % 4 != 1) { throw "Error _at" } try { return _a3._av((b - 17) >> 2) } catch (a) { throw "Error _av" } }; _a3._aw = function (d) { var b = 4294967295; var f = 0; for (var c = 0; c < _a3._bv.length; c++) { var a = _a3._bv[c]; if (a == d) { return this._av(c + 7) } var e = _ax._gj(d, a); if (e < b) { f = c + 7; b = e } } if (b <= 3) { return this._av(f) } return null }; function _ay() { return new Array(new _a3(1, new Array(), new _a2(7, new _a1(1, 19)), new _a2(10, new _a1(1, 16)), new _a2(13, new _a1(1, 13)), new _a2(17, new _a1(1, 9))), new _a3(2, new Array(6, 18), new _a2(10, new _a1(1, 34)), new _a2(16, new _a1(1, 28)), new _a2(22, new _a1(1, 22)), new _a2(28, new _a1(1, 16))), new _a3(3, new Array(6, 22), new _a2(15, new _a1(1, 55)), new _a2(26, new _a1(1, 44)), new _a2(18, new _a1(2, 17)), new _a2(22, new _a1(2, 13))), new _a3(4, new Array(6, 26), new _a2(20, new _a1(1, 80)), new _a2(18, new _a1(2, 32)), new _a2(26, new _a1(2, 24)), new _a2(16, new _a1(4, 9))), new _a3(5, new Array(6, 30), new _a2(26, new _a1(1, 108)), new _a2(24, new _a1(2, 43)), new _a2(18, new _a1(2, 15), new _a1(2, 16)), new _a2(22, new _a1(2, 11), new _a1(2, 12))), new _a3(6, new Array(6, 34), new _a2(18, new _a1(2, 68)), new _a2(16, new _a1(4, 27)), new _a2(24, new _a1(4, 19)), new _a2(28, new _a1(4, 15))), new _a3(7, new Array(6, 22, 38), new _a2(20, new _a1(2, 78)), new _a2(18, new _a1(4, 31)), new _a2(18, new _a1(2, 14), new _a1(4, 15)), new _a2(26, new _a1(4, 13), new _a1(1, 14))), new _a3(8, new Array(6, 24, 42), new _a2(24, new _a1(2, 97)), new _a2(22, new _a1(2, 38), new _a1(2, 39)), new _a2(22, new _a1(4, 18), new _a1(2, 19)), new _a2(26, new _a1(4, 14), new _a1(2, 15))), new _a3(9, new Array(6, 26, 46), new _a2(30, new _a1(2, 116)), new _a2(22, new _a1(3, 36), new _a1(2, 37)), new _a2(20, new _a1(4, 16), new _a1(4, 17)), new _a2(24, new _a1(4, 12), new _a1(4, 13))), new _a3(10, new Array(6, 28, 50), new _a2(18, new _a1(2, 68), new _a1(2, 69)), new _a2(26, new _a1(4, 43), new _a1(1, 44)), new _a2(24, new _a1(6, 19), new _a1(2, 20)), new _a2(28, new _a1(6, 15), new _a1(2, 16))), new _a3(11, new Array(6, 30, 54), new _a2(20, new _a1(4, 81)), new _a2(30, new _a1(1, 50), new _a1(4, 51)), new _a2(28, new _a1(4, 22), new _a1(4, 23)), new _a2(24, new _a1(3, 12), new _a1(8, 13))), new _a3(12, new Array(6, 32, 58), new _a2(24, new _a1(2, 92), new _a1(2, 93)), new _a2(22, new _a1(6, 36), new _a1(2, 37)), new _a2(26, new _a1(4, 20), new _a1(6, 21)), new _a2(28, new _a1(7, 14), new _a1(4, 15))), new _a3(13, new Array(6, 34, 62), new _a2(26, new _a1(4, 107)), new _a2(22, new _a1(8, 37), new _a1(1, 38)), new _a2(24, new _a1(8, 20), new _a1(4, 21)), new _a2(22, new _a1(12, 11), new _a1(4, 12))), new _a3(14, new Array(6, 26, 46, 66), new _a2(30, new _a1(3, 115), new _a1(1, 116)), new _a2(24, new _a1(4, 40), new _a1(5, 41)), new _a2(20, new _a1(11, 16), new _a1(5, 17)), new _a2(24, new _a1(11, 12), new _a1(5, 13))), new _a3(15, new Array(6, 26, 48, 70), new _a2(22, new _a1(5, 87), new _a1(1, 88)), new _a2(24, new _a1(5, 41), new _a1(5, 42)), new _a2(30, new _a1(5, 24), new _a1(7, 25)), new _a2(24, new _a1(11, 12), new _a1(7, 13))), new _a3(16, new Array(6, 26, 50, 74), new _a2(24, new _a1(5, 98), new _a1(1, 99)), new _a2(28, new _a1(7, 45), new _a1(3, 46)), new _a2(24, new _a1(15, 19), new _a1(2, 20)), new _a2(30, new _a1(3, 15), new _a1(13, 16))), new _a3(17, new Array(6, 30, 54, 78), new _a2(28, new _a1(1, 107), new _a1(5, 108)), new _a2(28, new _a1(10, 46), new _a1(1, 47)), new _a2(28, new _a1(1, 22), new _a1(15, 23)), new _a2(28, new _a1(2, 14), new _a1(17, 15))), new _a3(18, new Array(6, 30, 56, 82), new _a2(30, new _a1(5, 120), new _a1(1, 121)), new _a2(26, new _a1(9, 43), new _a1(4, 44)), new _a2(28, new _a1(17, 22), new _a1(1, 23)), new _a2(28, new _a1(2, 14), new _a1(19, 15))), new _a3(19, new Array(6, 30, 58, 86), new _a2(28, new _a1(3, 113), new _a1(4, 114)), new _a2(26, new _a1(3, 44), new _a1(11, 45)), new _a2(26, new _a1(17, 21), new _a1(4, 22)), new _a2(26, new _a1(9, 13), new _a1(16, 14))), new _a3(20, new Array(6, 34, 62, 90), new _a2(28, new _a1(3, 107), new _a1(5, 108)), new _a2(26, new _a1(3, 41), new _a1(13, 42)), new _a2(30, new _a1(15, 24), new _a1(5, 25)), new _a2(28, new _a1(15, 15), new _a1(10, 16))), new _a3(21, new Array(6, 28, 50, 72, 94), new _a2(28, new _a1(4, 116), new _a1(4, 117)), new _a2(26, new _a1(17, 42)), new _a2(28, new _a1(17, 22), new _a1(6, 23)), new _a2(30, new _a1(19, 16), new _a1(6, 17))), new _a3(22, new Array(6, 26, 50, 74, 98), new _a2(28, new _a1(2, 111), new _a1(7, 112)), new _a2(28, new _a1(17, 46)), new _a2(30, new _a1(7, 24), new _a1(16, 25)), new _a2(24, new _a1(34, 13))), new _a3(23, new Array(6, 30, 54, 78, 102), new _a2(30, new _a1(4, 121), new _a1(5, 122)), new _a2(28, new _a1(4, 47), new _a1(14, 48)), new _a2(30, new _a1(11, 24), new _a1(14, 25)), new _a2(30, new _a1(16, 15), new _a1(14, 16))), new _a3(24, new Array(6, 28, 54, 80, 106), new _a2(30, new _a1(6, 117), new _a1(4, 118)), new _a2(28, new _a1(6, 45), new _a1(14, 46)), new _a2(30, new _a1(11, 24), new _a1(16, 25)), new _a2(30, new _a1(30, 16), new _a1(2, 17))), new _a3(25, new Array(6, 32, 58, 84, 110), new _a2(26, new _a1(8, 106), new _a1(4, 107)), new _a2(28, new _a1(8, 47), new _a1(13, 48)), new _a2(30, new _a1(7, 24), new _a1(22, 25)), new _a2(30, new _a1(22, 15), new _a1(13, 16))), new _a3(26, new Array(6, 30, 58, 86, 114), new _a2(28, new _a1(10, 114), new _a1(2, 115)), new _a2(28, new _a1(19, 46), new _a1(4, 47)), new _a2(28, new _a1(28, 22), new _a1(6, 23)), new _a2(30, new _a1(33, 16), new _a1(4, 17))), new _a3(27, new Array(6, 34, 62, 90, 118), new _a2(30, new _a1(8, 122), new _a1(4, 123)), new _a2(28, new _a1(22, 45), new _a1(3, 46)), new _a2(30, new _a1(8, 23), new _a1(26, 24)), new _a2(30, new _a1(12, 15), new _a1(28, 16))), new _a3(28, new Array(6, 26, 50, 74, 98, 122), new _a2(30, new _a1(3, 117), new _a1(10, 118)), new _a2(28, new _a1(3, 45), new _a1(23, 46)), new _a2(30, new _a1(4, 24), new _a1(31, 25)), new _a2(30, new _a1(11, 15), new _a1(31, 16))), new _a3(29, new Array(6, 30, 54, 78, 102, 126), new _a2(30, new _a1(7, 116), new _a1(7, 117)), new _a2(28, new _a1(21, 45), new _a1(7, 46)), new _a2(30, new _a1(1, 23), new _a1(37, 24)), new _a2(30, new _a1(19, 15), new _a1(26, 16))), new _a3(30, new Array(6, 26, 52, 78, 104, 130), new _a2(30, new _a1(5, 115), new _a1(10, 116)), new _a2(28, new _a1(19, 47), new _a1(10, 48)), new _a2(30, new _a1(15, 24), new _a1(25, 25)), new _a2(30, new _a1(23, 15), new _a1(25, 16))), new _a3(31, new Array(6, 30, 56, 82, 108, 134), new _a2(30, new _a1(13, 115), new _a1(3, 116)), new _a2(28, new _a1(2, 46), new _a1(29, 47)), new _a2(30, new _a1(42, 24), new _a1(1, 25)), new _a2(30, new _a1(23, 15), new _a1(28, 16))), new _a3(32, new Array(6, 34, 60, 86, 112, 138), new _a2(30, new _a1(17, 115)), new _a2(28, new _a1(10, 46), new _a1(23, 47)), new _a2(30, new _a1(10, 24), new _a1(35, 25)), new _a2(30, new _a1(19, 15), new _a1(35, 16))), new _a3(33, new Array(6, 30, 58, 86, 114, 142), new _a2(30, new _a1(17, 115), new _a1(1, 116)), new _a2(28, new _a1(14, 46), new _a1(21, 47)), new _a2(30, new _a1(29, 24), new _a1(19, 25)), new _a2(30, new _a1(11, 15), new _a1(46, 16))), new _a3(34, new Array(6, 34, 62, 90, 118, 146), new _a2(30, new _a1(13, 115), new _a1(6, 116)), new _a2(28, new _a1(14, 46), new _a1(23, 47)), new _a2(30, new _a1(44, 24), new _a1(7, 25)), new _a2(30, new _a1(59, 16), new _a1(1, 17))), new _a3(35, new Array(6, 30, 54, 78, 102, 126, 150), new _a2(30, new _a1(12, 121), new _a1(7, 122)), new _a2(28, new _a1(12, 47), new _a1(26, 48)), new _a2(30, new _a1(39, 24), new _a1(14, 25)), new _a2(30, new _a1(22, 15), new _a1(41, 16))), new _a3(36, new Array(6, 24, 50, 76, 102, 128, 154), new _a2(30, new _a1(6, 121), new _a1(14, 122)), new _a2(28, new _a1(6, 47), new _a1(34, 48)), new _a2(30, new _a1(46, 24), new _a1(10, 25)), new _a2(30, new _a1(2, 15), new _a1(64, 16))), new _a3(37, new Array(6, 28, 54, 80, 106, 132, 158), new _a2(30, new _a1(17, 122), new _a1(4, 123)), new _a2(28, new _a1(29, 46), new _a1(14, 47)), new _a2(30, new _a1(49, 24), new _a1(10, 25)), new _a2(30, new _a1(24, 15), new _a1(46, 16))), new _a3(38, new Array(6, 32, 58, 84, 110, 136, 162), new _a2(30, new _a1(4, 122), new _a1(18, 123)), new _a2(28, new _a1(13, 46), new _a1(32, 47)), new _a2(30, new _a1(48, 24), new _a1(14, 25)), new _a2(30, new _a1(42, 15), new _a1(32, 16))), new _a3(39, new Array(6, 26, 54, 82, 110, 138, 166), new _a2(30, new _a1(20, 117), new _a1(4, 118)), new _a2(28, new _a1(40, 47), new _a1(7, 48)), new _a2(30, new _a1(43, 24), new _a1(22, 25)), new _a2(30, new _a1(10, 15), new _a1(67, 16))), new _a3(40, new Array(6, 30, 58, 86, 114, 142, 170), new _a2(30, new _a1(19, 118), new _a1(6, 119)), new _a2(28, new _a1(18, 47), new _a1(31, 48)), new _a2(30, new _a1(34, 24), new _a1(34, 25)), new _a2(30, new _a1(20, 15), new _a1(61, 16)))) } function _ae(i, f, c, h, e, b, g, d, a) { this.a11 = i; this.a12 = h; this.a13 = g; this.a21 = f; this.a22 = e; this.a23 = d; this.a31 = c; this.a32 = b; this.a33 = a; this._ad = function (v) { var s = v.length; var z = this.a11; var w = this.a12; var u = this.a13; var q = this.a21; var p = this.a22; var o = this.a23; var m = this.a31; var k = this.a32; var j = this.a33; for (var n = 0; n < s; n += 2) { var t = v[n]; var r = v[n + 1]; var l = u * t + o * r + j; v[n] = (z * t + q * r + m) / l; v[n + 1] = (w * t + p * r + k) / l } }; this._fp = function (m, k) { var q = m.length; for (var l = 0; l < q; l++) { var j = m[l]; var p = k[l]; var o = this.a13 * j + this.a23 * p + this.a33; m[l] = (this.a11 * j + this.a21 * p + this.a31) / o; k[l] = (this.a12 * j + this.a22 * p + this.a32) / o } }; this._fr = function () { return new _ae(this.a22 * this.a33 - this.a23 * this.a32, this.a23 * this.a31 - this.a21 * this.a33, this.a21 * this.a32 - this.a22 * this.a31, this.a13 * this.a32 - this.a12 * this.a33, this.a11 * this.a33 - this.a13 * this.a31, this.a12 * this.a31 - this.a11 * this.a32, this.a12 * this.a23 - this.a13 * this.a22, this.a13 * this.a21 - this.a11 * this.a23, this.a11 * this.a22 - this.a12 * this.a21) }; this.times = function (j) { return new _ae(this.a11 * j.a11 + this.a21 * j.a12 + this.a31 * j.a13, this.a11 * j.a21 + this.a21 * j.a22 + this.a31 * j.a23, this.a11 * j.a31 + this.a21 * j.a32 + this.a31 * j.a33, this.a12 * j.a11 + this.a22 * j.a12 + this.a32 * j.a13, this.a12 * j.a21 + this.a22 * j.a22 + this.a32 * j.a23, this.a12 * j.a31 + this.a22 * j.a32 + this.a32 * j.a33, this.a13 * j.a11 + this.a23 * j.a12 + this.a33 * j.a13, this.a13 * j.a21 + this.a23 * j.a22 + this.a33 * j.a23, this.a13 * j.a31 + this.a23 * j.a32 + this.a33 * j.a33) } } _ae._ag = function (p, e, o, d, n, c, m, b, h, q, l, f, a, j, i, r) { var g = this._be(p, e, o, d, n, c, m, b); var k = this._bf(h, q, l, f, a, j, i, r); return k.times(g) }; _ae._bf = function (d, p, c, m, b, k, a, j) { var h = j - k; var f = p - m + k - j; if (h == 0 && f == 0) { return new _ae(c - d, b - c, d, m - p, k - m, p, 0, 0, 1) } else { var q = c - b; var o = a - b; var l = d - c + b - a; var i = m - k; var e = q * h - o * i; var n = (l * h - o * f) / e; var g = (q * f - l * i) / e; return new _ae(c - d + n * c, a - d + g * a, d, m - p + n * m, j - p + g * j, p, n, g, 1) } }; _ae._be = function (f, h, d, g, b, e, a, c) { return this._bf(f, h, d, g, b, e, a, c)._fr() }; function _bg(b, a) { this.bits = b; this.points = a } function Detector(a) { this.image = a; this._am = null; this._bi = function (m, l, c, b) { var d = Math.abs(b - l) > Math.abs(c - m); if (d) { var r = m; m = l; l = r; r = c; c = b; b = r } var j = Math.abs(c - m); var i = Math.abs(b - l); var p = -j >> 1; var u = l < b ? 1 : -1; var f = m < c ? 1 : -1; var e = 0; for (var h = m, g = l; h != c; h += f) { var t = d ? g : h; var s = d ? h : g; if (e == 1) { if (this.image[t + s * qrcode.width]) { e++ } } else { if (!this.image[t + s * qrcode.width]) { e++ } } if (e == 3) { var o = h - m; var n = g - l; return Math.sqrt((o * o + n * n)) } p += i; if (p > 0) { if (g == b) { break } g += u; p -= j } } var k = c - m; var q = b - l; return Math.sqrt((k * k + q * q)) }; this._bh = function (i, g, h, f) { var b = this._bi(i, g, h, f); var e = 1; var d = i - (h - i); if (d < 0) { e = i / (i - d); d = 0 } else { if (d >= qrcode.width) { e = (qrcode.width - 1 - i) / (d - i); d = qrcode.width - 1 } } var c = Math.floor(g - (f - g) * e); e = 1; if (c < 0) { e = g / (g - c); c = 0 } else { if (c >= qrcode.height) { e = (qrcode.height - 1 - g) / (c - g); c = qrcode.height - 1 } } d = Math.floor(i + (d - i) * e); b += this._bi(i, g, d, c); return b - 1 }; this._bj = function (c, d) { var b = this._bh(Math.floor(c.X), Math.floor(c.Y), Math.floor(d.X), Math.floor(d.Y)); var e = this._bh(Math.floor(d.X), Math.floor(d.Y), Math.floor(c.X), Math.floor(c.Y)); if (isNaN(b)) { return e / 7 } if (isNaN(e)) { return b / 7 } return (b + e) / 14 }; this._bk = function (d, c, b) { return (this._bj(d, c) + this._bj(d, b)) / 2 }; this.distance = function (d, b) { var e = d.X - b.X; var c = d.Y - b.Y; return Math.sqrt((e * e + c * c)) }; this._bx = function (g, f, d, e) { var b = Math.round(this.distance(g, f) / e); var c = Math.round(this.distance(g, d) / e); var h = ((b + c) >> 1) + 7; switch (h & 3) { case 0: h++; break; case 2: h--; break; case 3: throw "Error" }return h }; this._bl = function (g, f, d, j) { var k = Math.floor(j * g); var h = Math.max(0, f - k); var i = Math.min(qrcode.width - 1, f + k); if (i - h < g * 3) { throw "Error" } var b = Math.max(0, d - k); var c = Math.min(qrcode.height - 1, d + k); var e = new _ak(this.image, h, b, i - h, c - b, g, this._am); return e.find() }; this.createTransform = function (l, h, k, b, g) { var j = g - 3.5; var i; var f; var e; var c; if (b != null) { i = b.X; f = b.Y; e = c = j - 3 } else { i = (h.X - l.X) + k.X; f = (h.Y - l.Y) + k.Y; e = c = j } var d = _ae._ag(3.5, 3.5, j, 3.5, e, c, 3.5, j, l.X, l.Y, h.X, h.Y, i, f, k.X, k.Y); return d }; this._bz = function (e, b, d) { var c = _aa; return c._af(e, d, b) }; this._cd = function (q) { var j = q._gq; var h = q._gs; var n = q._gp; var d = this._bk(j, h, n); if (d < 1) { throw "Error" } var r = this._bx(j, h, n, d); var b = _a3._at(r); var k = b._cr - 7; var l = null; if (b._as.length > 0) { var f = h.X - j.X + n.X; var e = h.Y - j.Y + n.Y; var c = 1 - 3 / k; var t = Math.floor(j.X + c * (f - j.X)); var s = Math.floor(j.Y + c * (e - j.Y)); for (var p = 4; p <= 16; p <<= 1) { l = this._bl(d, t, s, p); break } } var g = this.createTransform(j, h, n, l, r); var m = this._bz(this.image, g, r); var o; if (l == null) { o = new Array(n, j, h) } else { o = new Array(n, j, h, l) } return new _bg(m, o) }; this.detect = function () { var b = new _cc()._ce(this.image); return this._cd(b) } } var _ca = 21522; var _cb = new Array(new Array(21522, 0), new Array(20773, 1), new Array(24188, 2), new Array(23371, 3), new Array(17913, 4), new Array(16590, 5), new Array(20375, 6), new Array(19104, 7), new Array(30660, 8), new Array(29427, 9), new Array(32170, 10), new Array(30877, 11), new Array(26159, 12), new Array(25368, 13), new Array(27713, 14), new Array(26998, 15), new Array(5769, 16), new Array(5054, 17), new Array(7399, 18), new Array(6608, 19), new Array(1890, 20), new Array(597, 21), new Array(3340, 22), new Array(2107, 23), new Array(13663, 24), new Array(12392, 25), new Array(16177, 26), new Array(14854, 27), new Array(9396, 28), new Array(8579, 29), new Array(11994, 30), new Array(11245, 31)); var _ch = new Array(0, 1, 1, 2, 1, 2, 2, 3, 1, 2, 2, 3, 2, 3, 3, 4); function _ax(a) { this._cf = _cg.forBits((a >> 3) & 3); this._fe = (a & 7); this.__defineGetter__("_cg", function () { return this._cf }); this.__defineGetter__("_dx", function () { return this._fe }); this.GetHashCode = function () { return (this._cf.ordinal() << 3) | this._fe }; this.Equals = function (c) { var b = c; return this._cf == b._cf && this._fe == b._fe } } _ax._gj = function (d, c) { d ^= c; return _ch[d & 15] + _ch[(_ew(d, 4) & 15)] + _ch[(_ew(d, 8) & 15)] + _ch[(_ew(d, 12) & 15)] + _ch[(_ew(d, 16) & 15)] + _ch[(_ew(d, 20) & 15)] + _ch[(_ew(d, 24) & 15)] + _ch[(_ew(d, 28) & 15)] }; _ax._ci = function (a) { var b = _ax._cj(a); if (b != null) { return b } return _ax._cj(a ^ _ca) }; _ax._cj = function (d) { var b = 4294967295; var a = 0; for (var c = 0; c < _cb.length; c++) { var g = _cb[c]; var f = g[0]; if (f == d) { return new _ax(g[1]) } var e = this._gj(d, f); if (e < b) { a = g[1]; b = e } } if (b <= 3) { return new _ax(a) } return null }; function _cg(a, c, b) { this._ff = a; this.bits = c; this.name = b; this.__defineGetter__("Bits", function () { return this.bits }); this.__defineGetter__("Name", function () { return this.name }); this.ordinal = function () { return this._ff } } _cg.forBits = function (a) { if (a < 0 || a >= FOR_BITS.length) { throw "bad arguments" } return FOR_BITS[a] }; var L = new _cg(0, 1, "L"); var M = new _cg(1, 0, "M"); var Q = new _cg(2, 3, "Q"); var H = new _cg(3, 2, "H"); var FOR_BITS = new Array(M, L, H, Q); function _ac(d, a) { if (!a) { a = d } if (d < 1 || a < 1) { throw "Both dimensions must be greater than 0" } this.width = d; this.height = a; var c = d >> 5; if ((d & 31) != 0) { c++ } this.rowSize = c; this.bits = new Array(c * a); for (var b = 0; b < this.bits.length; b++) { this.bits[b] = 0 } this.__defineGetter__("Width", function () { return this.width }); this.__defineGetter__("Height", function () { return this.height }); this.__defineGetter__("Dimension", function () { if (this.width != this.height) { throw "Can't call getDimension() on a non-square matrix" } return this.width }); this._ds = function (e, g) { var f = g * this.rowSize + (e >> 5); return ((_ew(this.bits[f], (e & 31))) & 1) != 0 }; this._dq = function (e, g) { var f = g * this.rowSize + (e >> 5); this.bits[f] |= 1 << (e & 31) }; this.flip = function (e, g) { var f = g * this.rowSize + (e >> 5); this.bits[f] ^= 1 << (e & 31) }; this.clear = function () { var e = this.bits.length; for (var f = 0; f < e; f++) { this.bits[f] = 0 } }; this._bq = function (g, j, f, m) { if (j < 0 || g < 0) { throw "Left and top must be nonnegative" } if (m < 1 || f < 1) { throw "Height and width must be at least 1" } var l = g + f; var e = j + m; if (e > this.height || l > this.width) { throw "The region must fit inside the matrix" } for (var i = j; i < e; i++) { var h = i * this.rowSize; for (var k = g; k < l; k++) { this.bits[h + (k >> 5)] |= 1 << (k & 31) } } } } function _dl(a, b) { this._dv = a; this._dw = b; this.__defineGetter__("_du", function () { return this._dv }); this.__defineGetter__("Codewords", function () { return this._dw }) } _dl._gn = function (c, h, r) { if (c.length != h._dp) { throw "bad arguments" } var k = h._bu(r); var e = 0; var d = k._fb(); for (var q = 0; q < d.length; q++) { e += d[q].Count } var l = new Array(e); var n = 0; for (var o = 0; o < d.length; o++) { var f = d[o]; for (var q = 0; q < f.Count; q++) { var m = f._dm; var s = k._bo + m; l[n++] = new _dl(m, new Array(s)) } } var t = l[0]._dw.length; var b = l.length - 1; while (b >= 0) { var v = l[b]._dw.length; if (v == t) { break } b-- } b++; var g = t - k._bo; var a = 0; for (var q = 0; q < g; q++) { for (var o = 0; o < n; o++) { l[o]._dw[q] = c[a++] } } for (var o = b; o < n; o++) { l[o]._dw[g] = c[a++] } var p = l[0]._dw.length; for (var q = g; q < p; q++) { for (var o = 0; o < n; o++) { var u = o < b ? q : q + 1; l[o]._dw[u] = c[a++] } } return l }; function _cl(a) { var b = a.Dimension; if (b < 21 || (b & 3) != 1) { throw "Error _cl" } this._au = a; this._cp = null; this._co = null; this._dk = function (d, c, e) { return this._au._ds(d, c) ? (e << 1) | 1 : e << 1 }; this._cm = function () { if (this._co != null) { return this._co } var g = 0; for (var e = 0; e < 6; e++) { g = this._dk(e, 8, g) } g = this._dk(7, 8, g); g = this._dk(8, 8, g); g = this._dk(8, 7, g); for (var c = 5; c >= 0; c--) { g = this._dk(8, c, g) } this._co = _ax._ci(g); if (this._co != null) { return this._co } var f = this._au.Dimension; g = 0; var d = f - 8; for (var e = f - 1; e >= d; e--) { g = this._dk(e, 8, g) } for (var c = f - 7; c < f; c++) { g = this._dk(8, c, g) } this._co = _ax._ci(g); if (this._co != null) { return this._co } throw "Error _cm" }; this._cq = function () { if (this._cp != null) { return this._cp } var h = this._au.Dimension; var f = (h - 17) >> 2; if (f <= 6) { return _a3._av(f) } var g = 0; var e = h - 11; for (var c = 5; c >= 0; c--) { for (var d = h - 9; d >= e; d--) { g = this._dk(d, c, g) } } this._cp = _a3._aw(g); if (this._cp != null && this._cp._cr == h) { return this._cp } g = 0; for (var d = 5; d >= 0; d--) { for (var c = h - 9; c >= e; c--) { g = this._dk(d, c, g) } } this._cp = _a3._aw(g); if (this._cp != null && this._cp._cr == h) { return this._cp } throw "Error _cq" }; this._gk = function () { var q = this._cm(); var o = this._cq(); var c = _dx._gl(q._dx); var f = this._au.Dimension; c._dj(this._au, f); var k = o._aq(); var n = true; var r = new Array(o._dp); var m = 0; var p = 0; var h = 0; for (var e = f - 1; e > 0; e -= 2) { if (e == 6) { e-- } for (var l = 0; l < f; l++) { var g = n ? f - 1 - l : l; for (var d = 0; d < 2; d++) { if (!k._ds(e - d, g)) { h++; p <<= 1; if (this._au._ds(e - d, g)) { p |= 1 } if (h == 8) { r[m++] = p; h = 0; p = 0 } } } } n ^= true } if (m != o._dp) { throw "Error _gk" } return r } } var _dx = {}; _dx._gl = function (a) { if (a < 0 || a > 7) { throw "bad arguments" } return _dx._dy[a] }; function _fg() { this._dj = function (c, d) { for (var b = 0; b < d; b++) { for (var a = 0; a < d; a++) { if (this._fw(b, a)) { c.flip(a, b) } } } }; this._fw = function (b, a) { return ((b + a) & 1) == 0 } } function _fh() { this._dj = function (c, d) { for (var b = 0; b < d; b++) { for (var a = 0; a < d; a++) { if (this._fw(b, a)) { c.flip(a, b) } } } }; this._fw = function (b, a) { return (b & 1) == 0 } } function _fi() { this._dj = function (c, d) { for (var b = 0; b < d; b++) { for (var a = 0; a < d; a++) { if (this._fw(b, a)) { c.flip(a, b) } } } }; this._fw = function (b, a) { return a % 3 == 0 } } function _fj() { this._dj = function (c, d) { for (var b = 0; b < d; b++) { for (var a = 0; a < d; a++) { if (this._fw(b, a)) { c.flip(a, b) } } } }; this._fw = function (b, a) { return (b + a) % 3 == 0 } } function _fk() { this._dj = function (c, d) { for (var b = 0; b < d; b++) { for (var a = 0; a < d; a++) { if (this._fw(b, a)) { c.flip(a, b) } } } }; this._fw = function (b, a) { return (((_ew(b, 1)) + (a / 3)) & 1) == 0 } } function _fl() { this._dj = function (c, d) { for (var b = 0; b < d; b++) { for (var a = 0; a < d; a++) { if (this._fw(b, a)) { c.flip(a, b) } } } }; this._fw = function (c, b) { var a = c * b; return (a & 1) + (a % 3) == 0 } } function _fm() { this._dj = function (c, d) { for (var b = 0; b < d; b++) { for (var a = 0; a < d; a++) { if (this._fw(b, a)) { c.flip(a, b) } } } }; this._fw = function (c, b) { var a = c * b; return (((a & 1) + (a % 3)) & 1) == 0 } } function _fn() { this._dj = function (c, d) { for (var b = 0; b < d; b++) { for (var a = 0; a < d; a++) { if (this._fw(b, a)) { c.flip(a, b) } } } }; this._fw = function (b, a) { return ((((b + a) & 1) + ((b * a) % 3)) & 1) == 0 } } _dx._dy = new Array(new _fg(), new _fh(), new _fi(), new _fj(), new _fk(), new _fl(), new _fm(), new _fn()); function _db(a) { this._fa = a; this.decode = function (j, f) { var c = new _bp(this._fa, j); var p = new Array(f); for (var g = 0; g < p.length; g++) { p[g] = 0 } var m = false; var d = true; for (var g = 0; g < f; g++) { var q = c.evaluateAt(this._fa.exp(m ? g + 1 : g)); p[p.length - 1 - g] = q; if (q != 0) { d = false } } if (d) { return } var b = new _bp(this._fa, p); var l = this._eb(this._fa._ba(f, 1), b, f); var o = l[0]; var n = l[1]; var k = this._ey(o); var e = this._di(n, k, m); for (var g = 0; g < k.length; g++) { var h = j.length - 1 - this._fa.log(k[g]); if (h < 0) { throw "ReedSolomonException Bad error location" } j[h] = _az._bd(j[h], e[g]) } }; this._eb = function (z, y, f) { if (z._ec < y._ec) { var w = z; z = y; y = w } var B = z; var k = y; var o = this._fa.One; var j = this._fa.Zero; var e = this._fa.Zero; var i = this._fa.One; while (k._ec >= Math.floor(f / 2)) { var x = B; var g = o; var v = e; B = k; o = j; e = i; if (B.Zero) { throw "r_{i-1} was zero" } k = x; var m = this._fa.Zero; var p = B._ex(B._ec); var h = this._fa.inverse(p); while (k._ec >= B._ec && !k.Zero) { var c = k._ec - B._ec; var A = this._fa.multiply(k._ex(k._ec), h); m = m._bd(this._fa._ba(c, A)); k = k._bd(B._dc(c, A)) } j = m.multiply1(o)._bd(g); i = m.multiply1(e)._bd(v) } var u = i._ex(0); if (u == 0) { throw "ReedSolomonException sigmaTilde(0) was zero" } var d = this._fa.inverse(u); var n = i.multiply2(d); var l = k.multiply2(d); return new Array(n, l) }; this._ey = function (f) { var g = f._ec; if (g == 1) { return new Array(f._ex(1)) } var b = new Array(g); var d = 0; for (var c = 1; c < 256 && d < g; c++) { if (f.evaluateAt(c) == 0) { b[d] = this._fa.inverse(c); d++ } } if (d != g) { throw "Error locator degree does not match number of roots" } return b }; this._di = function (f, h, g) { var k = h.length; var l = new Array(k); for (var e = 0; e < k; e++) { var b = this._fa.inverse(h[e]); var c = 1; for (var d = 0; d < k; d++) { if (e != d) { c = this._fa.multiply(c, _az._bd(1, this._fa.multiply(h[d], b))) } } l[e] = this._fa.multiply(f.evaluateAt(b), this._fa.inverse(c)); if (g) { l[e] = this._fa.multiply(l[e], b) } } return l } } function _bp(f, e) { if (e == null || e.length == 0) { throw "bad arguments" } this._fa = f; var c = e.length; if (c > 1 && e[0] == 0) { var d = 1; while (d < c && e[d] == 0) { d++ } if (d == c) { this._dd = f.Zero._dd } else { this._dd = new Array(c - d); for (var b = 0; b < this._dd.length; b++) { this._dd[b] = 0 } for (var a = 0; a < this._dd.length; a++) { this._dd[a] = e[d + a] } } } else { this._dd = e } this.__defineGetter__("Zero", function () { return this._dd[0] == 0 }); this.__defineGetter__("_ec", function () { return this._dd.length - 1 }); this.__defineGetter__("Coefficients", function () { return this._dd }); this._ex = function (g) { return this._dd[this._dd.length - 1 - g] }; this.evaluateAt = function (h) { if (h == 0) { return this._ex(0) } var l = this._dd.length; if (h == 1) { var g = 0; for (var k = 0; k < l; k++) { g = _az._bd(g, this._dd[k]) } return g } var j = this._dd[0]; for (var k = 1; k < l; k++) { j = _az._bd(this._fa.multiply(h, j), this._dd[k]) } return j }; this._bd = function (g) { if (this._fa != g._fa) { throw "GF256Polys do not have same _az _fa" } if (this.Zero) { return g } if (g.Zero) { return this } var o = this._dd; var n = g._dd; if (o.length > n.length) { var j = o; o = n; n = j } var h = new Array(n.length); var k = n.length - o.length; for (var m = 0; m < k; m++) { h[m] = n[m] } for (var l = k; l < n.length; l++) { h[l] = _az._bd(o[l - k], n[l]) } return new _bp(f, h) }; this.multiply1 = function (o) { if (this._fa != o._fa) { throw "GF256Polys do not have same _az _fa" } if (this.Zero || o.Zero) { return this._fa.Zero } var q = this._dd; var g = q.length; var l = o._dd; var n = l.length; var p = new Array(g + n - 1); for (var m = 0; m < g; m++) { var h = q[m]; for (var k = 0; k < n; k++) { p[m + k] = _az._bd(p[m + k], this._fa.multiply(h, l[k])) } } return new _bp(this._fa, p) }; this.multiply2 = function (g) { if (g == 0) { return this._fa.Zero } if (g == 1) { return this } var j = this._dd.length; var k = new Array(j); for (var h = 0; h < j; h++) { k[h] = this._fa.multiply(this._dd[h], g) } return new _bp(this._fa, k) }; this._dc = function (l, g) { if (l < 0) { throw "bad arguments" } if (g == 0) { return this._fa.Zero } var j = this._dd.length; var k = new Array(j + l); for (var h = 0; h < k.length; h++) { k[h] = 0 } for (var h = 0; h < j; h++) { k[h] = this._fa.multiply(this._dd[h], g) } return new _bp(this._fa, k) }; this.divide = function (l) { if (this._fa != l._fa) { throw "GF256Polys do not have same _az _fa" } if (l.Zero) { throw "Divide by 0" } var j = this._fa.Zero; var o = this; var g = l._ex(l._ec); var n = this._fa.inverse(g); while (o._ec >= l._ec && !o.Zero) { var m = o._ec - l._ec; var h = this._fa.multiply(o._ex(o._ec), n); var i = l._dc(m, h); var k = this._fa._ba(m, h); j = j._bd(k); o = o._bd(i) } return new Array(j, o) } } function _az(b) { this._gh = new Array(256); this._gi = new Array(256); var a = 1; for (var e = 0; e < 256; e++) { this._gh[e] = a; a <<= 1; if (a >= 256) { a ^= b } } for (var e = 0; e < 255; e++) { this._gi[this._gh[e]] = e } var d = new Array(1); d[0] = 0; this.zero = new _bp(this, new Array(d)); var c = new Array(1); c[0] = 1; this.one = new _bp(this, new Array(c)); this.__defineGetter__("Zero", function () { return this.zero }); this.__defineGetter__("One", function () { return this.one }); this._ba = function (j, f) { if (j < 0) { throw "bad arguments" } if (f == 0) { return this.zero } var h = new Array(j + 1); for (var g = 0; g < h.length; g++) { h[g] = 0 } h[0] = f; return new _bp(this, h) }; this.exp = function (f) { return this._gh[f] }; this.log = function (f) { if (f == 0) { throw "bad arguments" } return this._gi[f] }; this.inverse = function (f) { if (f == 0) { throw "System.ArithmeticException" } return this._gh[255 - this._gi[f]] }; this.multiply = function (g, f) { if (g == 0 || f == 0) { return 0 } if (g == 1) { return f } if (f == 1) { return g } return this._gh[(this._gi[g] + this._gi[f]) % 255] } } _az._bb = new _az(285); _az._bc = new _az(301); _az._bd = function (d, c) { return d ^ c }; var Decoder = {}; Decoder.rsDecoder = new _db(_az._bb); Decoder.correctErrors = function (g, b) { var d = g.length; var f = new Array(d); for (var e = 0; e < d; e++) { f[e] = g[e] & 255 } var a = g.length - b; try { Decoder.rsDecoder.decode(f, a) } catch (c) { throw c } for (var e = 0; e < b; e++) { g[e] = f[e] } }; Decoder.decode = function (q) { var b = new _cl(q); var o = b._cq(); var c = b._cm()._cg; var p = b._gk(); var a = _dl._gn(p, o, c); var f = 0; for (var k = 0; k < a.length; k++) { f += a[k]._du } var e = new Array(f); var n = 0; for (var h = 0; h < a.length; h++) { var m = a[h]; var d = m.Codewords; var g = m._du; Decoder.correctErrors(d, g); for (var k = 0; k < g; k++) { e[n++] = d[k] } } var l = new QRCodeDataBlockReader(e, o._fd, c.Bits); return l }; var qrcode = {}; qrcode.imagedata = null; qrcode.width = 0; qrcode.height = 0; qrcode.qrCodeSymbol = null; qrcode.debug = false; qrcode.maxImgSize = 1024 * 1024; qrcode._eo = [[10, 9, 8, 8], [12, 11, 16, 10], [14, 13, 16, 12]]; qrcode.callback = null; qrcode.vidSuccess = function (a) { qrcode.localstream = a; if (qrcode.webkit) { qrcode.video.src = window.webkitURL.createObjectURL(a) } else { if (qrcode.moz) { qrcode.video.mozSrcObject = a; qrcode.video.play() } else { qrcode.video.src = a } } qrcode.gUM = true; qrcode.canvas_qr2 = document.createElement("canvas"); qrcode.canvas_qr2.id = "qr-canvas"; qrcode.qrcontext2 = qrcode.canvas_qr2.getContext("2d"); qrcode.canvas_qr2.width = qrcode.video.videoWidth; qrcode.canvas_qr2.height = qrcode.video.videoHeight; setTimeout(qrcode.captureToCanvas, 500) }; qrcode.vidError = function (a) { qrcode.gUM = false; return }; qrcode.captureToCanvas = function () { if (qrcode.gUM) { try { if (qrcode.video.videoWidth == 0) { setTimeout(qrcode.captureToCanvas, 500); return } else { qrcode.canvas_qr2.width = qrcode.video.videoWidth; qrcode.canvas_qr2.height = qrcode.video.videoHeight } qrcode.qrcontext2.drawImage(qrcode.video, 0, 0); try { qrcode.decode() } catch (a) { console.log(a); setTimeout(qrcode.captureToCanvas, 500) } } catch (a) { console.log(a); setTimeout(qrcode.captureToCanvas, 500) } } }; qrcode.setWebcam = function (c) { var d = navigator; qrcode.video = document.getElementById(c); var a = true; if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) { try { navigator.mediaDevices.enumerateDevices().then(function (e) { e.forEach(function (f) { console.log("deb1"); if (f.kind === "videoinput") { if (f.label.toLowerCase().search("back") > -1) { a = [{ sourceId: f.deviceId }] } } console.log(f.kind + ": " + f.label + " id = " + f.deviceId) }) }) } catch (b) { console.log(b) } } else { console.log("no navigator.mediaDevices.enumerateDevices") } if (d.getUserMedia) { d.getUserMedia({ video: a, audio: false }, qrcode.vidSuccess, qrcode.vidError) } else { if (d.webkitGetUserMedia) { qrcode.webkit = true; d.webkitGetUserMedia({ video: a, audio: false }, qrcode.vidSuccess, qrcode.vidError) } else { if (d.mozGetUserMedia) { qrcode.moz = true; d.mozGetUserMedia({ video: a, audio: false }, qrcode.vidSuccess, qrcode.vidError) } } } }; qrcode.decode = function (d) { if (arguments.length == 0) { if (qrcode.canvas_qr2) { var b = qrcode.canvas_qr2; var a = qrcode.qrcontext2 } else { var b = document.getElementById("qr-canvas"); var a = b.getContext("2d") } qrcode.width = b.width; qrcode.height = b.height; qrcode.imagedata = a.getImageData(0, 0, qrcode.width, qrcode.height); qrcode.result = qrcode.process(a); if (qrcode.callback != null) { qrcode.callback(qrcode.result) } return qrcode.result } else { var c = new Image(); c.crossOrigin = "Anonymous"; c.onload = function () { var g = document.getElementById("out-canvas"); if (g != null) { var j = g.getContext("2d"); j.clearRect(0, 0, 320, 240); j.drawImage(c, 0, 0, 320, 240) } var i = document.createElement("canvas"); var h = i.getContext("2d"); var f = c.height; var l = c.width; if (c.width * c.height > qrcode.maxImgSize) { var k = c.width / c.height; f = Math.sqrt(qrcode.maxImgSize / k); l = k * f } i.width = l; i.height = f; h.drawImage(c, 0, 0, i.width, i.height); qrcode.width = i.width; qrcode.height = i.height; try { qrcode.imagedata = h.getImageData(0, 0, i.width, i.height) } catch (m) { qrcode.result = "Cross domain image reading not supported in your browser! Save it to your computer then drag and drop the file!"; if (qrcode.callback != null) { qrcode.callback(qrcode.result) } return } try { qrcode.result = qrcode.process(h) } catch (m) { console.log(m); qrcode.result = "error decoding QR Code" } if (qrcode.callback != null) { qrcode.callback(qrcode.result) } }; c.onerror = function () { if (qrcode.callback != null) { qrcode.callback("Failed to load the image") } }; c.src = d } }; qrcode.isUrl = function (a) { var b = /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/; return b.test(a) }; qrcode.decode_url = function (b) { var d = ""; try { d = escape(b) } catch (c) { console.log(c); d = b } var a = ""; try { a = decodeURIComponent(d) } catch (c) { console.log(c); a = d } return a }; qrcode.decode_utf8 = function (a) { if (qrcode.isUrl(a)) { return qrcode.decode_url(a) } else { return a } }; qrcode.process = function (q) { var a = new Date().getTime(); var c = qrcode.grayScaleToBitmap(qrcode.grayscale()); if (qrcode.debug) { for (var m = 0; m < qrcode.height; m++) { for (var n = 0; n < qrcode.width; n++) { var o = (n * 4) + (m * qrcode.width * 4); qrcode.imagedata.data[o] = c[n + m * qrcode.width] ? 0 : 0; qrcode.imagedata.data[o + 1] = c[n + m * qrcode.width] ? 0 : 0; qrcode.imagedata.data[o + 2] = c[n + m * qrcode.width] ? 255 : 0 } } q.putImageData(qrcode.imagedata, 0, 0) } var h = new Detector(c); var p = h.detect(); if (qrcode.debug) { for (var m = 0; m < p.bits.Height; m++) { for (var n = 0; n < p.bits.Width; n++) { var o = (n * 4 * 2) + (m * 2 * qrcode.width * 4); qrcode.imagedata.data[o] = p.bits._ds(n, m) ? 0 : 0; qrcode.imagedata.data[o + 1] = p.bits._ds(n, m) ? 0 : 0; qrcode.imagedata.data[o + 2] = p.bits._ds(n, m) ? 255 : 0 } } q.putImageData(qrcode.imagedata, 0, 0) } var k = Decoder.decode(p.bits); var g = k.DataByte; var l = ""; for (var f = 0; f < g.length; f++) { for (var e = 0; e < g[f].length; e++) { l += String.fromCharCode(g[f][e]) } } var d = new Date().getTime(); var b = d - a; console.log(b); return qrcode.decode_utf8(l) }; qrcode.getPixel = function (b, d) { if (qrcode.width < b) { throw "point error" } if (qrcode.height < d) { throw "point error" } var a = (b * 4) + (d * qrcode.width * 4); var c = (qrcode.imagedata.data[a] * 33 + qrcode.imagedata.data[a + 1] * 34 + qrcode.imagedata.data[a + 2] * 33) / 100; return c }; qrcode.binarize = function (d) { var c = new Array(qrcode.width * qrcode.height); for (var e = 0; e < qrcode.height; e++) { for (var b = 0; b < qrcode.width; b++) { var a = qrcode.getPixel(b, e); c[b + e * qrcode.width] = a <= d ? true : false } } return c }; qrcode._em = function (d) { var c = 4; var k = Math.floor(qrcode.width / c); var j = Math.floor(qrcode.height / c); var f = new Array(c); for (var g = 0; g < c; g++) { f[g] = new Array(c); for (var e = 0; e < c; e++) { f[g][e] = new Array(0, 0) } } for (var o = 0; o < c; o++) { for (var a = 0; a < c; a++) { f[a][o][0] = 255; for (var l = 0; l < j; l++) { for (var n = 0; n < k; n++) { var h = d[k * a + n + (j * o + l) * qrcode.width]; if (h < f[a][o][0]) { f[a][o][0] = h } if (h > f[a][o][1]) { f[a][o][1] = h } } } } } var m = new Array(c); for (var b = 0; b < c; b++) { m[b] = new Array(c) } for (var o = 0; o < c; o++) { for (var a = 0; a < c; a++) { m[a][o] = Math.floor((f[a][o][0] + f[a][o][1]) / 2) } } return m }; qrcode.grayScaleToBitmap = function (f) { var k = qrcode._em(f); var b = k.length; var e = Math.floor(qrcode.width / b); var d = Math.floor(qrcode.height / b); var h = new ArrayBuffer(qrcode.width * qrcode.height); var c = new Uint8Array(h); for (var j = 0; j < b; j++) { for (var a = 0; a < b; a++) { for (var g = 0; g < d; g++) { for (var i = 0; i < e; i++) { c[e * a + i + (d * j + g) * qrcode.width] = (f[e * a + i + (d * j + g) * qrcode.width] < k[a][j]) ? true : false } } } } return c }; qrcode.grayscale = function () { var e = new ArrayBuffer(qrcode.width * qrcode.height); var c = new Uint8Array(e); for (var d = 0; d < qrcode.height; d++) { for (var b = 0; b < qrcode.width; b++) { var a = qrcode.getPixel(b, d); c[b + d * qrcode.width] = a } } return c }; function _ew(a, b) { if (a >= 0) { return a >> b } else { return (a >> b) + (2 << ~b) } } var _gf = 3; var _eh = 57; var _el = 8; var _eg = 2; qrcode._er = function (c) { function b(m, k) { var n = m.X - k.X; var l = m.Y - k.Y; return Math.sqrt((n * n + l * l)) } function d(k, o, n) { var m = o.x; var l = o.y; return ((n.x - m) * (k.y - l)) - ((n.y - l) * (k.x - m)) } var i = b(c[0], c[1]); var f = b(c[1], c[2]); var e = b(c[0], c[2]); var a, j, h; if (f >= i && f >= e) { j = c[0]; a = c[1]; h = c[2] } else { if (e >= f && e >= i) { j = c[1]; a = c[0]; h = c[2] } else { j = c[2]; a = c[0]; h = c[1] } } if (d(a, j, h) < 0) { var g = a; a = h; h = g } c[0] = a; c[1] = j; c[2] = h }; function _cz(c, a, b) { this.x = c; this.y = a; this.count = 1; this._aj = b; this.__defineGetter__("_ei", function () { return this._aj }); this.__defineGetter__("Count", function () { return this.count }); this.__defineGetter__("X", function () { return this.x }); this.__defineGetter__("Y", function () { return this.y }); this._ek = function () { this.count++ }; this._ev = function (f, e, d) { if (Math.abs(e - this.y) <= f && Math.abs(d - this.x) <= f) { var g = Math.abs(f - this._aj); return g <= 1 || g / this._aj <= 1 } return false } } function _es(a) { this._go = a[0]; this._gu = a[1]; this._gr = a[2]; this.__defineGetter__("_gp", function () { return this._go }); this.__defineGetter__("_gq", function () { return this._gu }); this.__defineGetter__("_gs", function () { return this._gr }) } function _cc() { this.image = null; this._cv = []; this._ge = false; this._al = new Array(0, 0, 0, 0, 0); this._am = null; this.__defineGetter__("_da", function () { this._al[0] = 0; this._al[1] = 0; this._al[2] = 0; this._al[3] = 0; this._al[4] = 0; return this._al }); this._ao = function (f) { var b = 0; for (var d = 0; d < 5; d++) { var e = f[d]; if (e == 0) { return false } b += e } if (b < 7) { return false } var c = Math.floor((b << _el) / 7); var a = Math.floor(c / 2); return Math.abs(c - (f[0] << _el)) < a && Math.abs(c - (f[1] << _el)) < a && Math.abs(3 * c - (f[2] << _el)) < 3 * a && Math.abs(c - (f[3] << _el)) < a && Math.abs(c - (f[4] << _el)) < a }; this._an = function (b, a) { return (a - b[4] - b[3]) - b[2] / 2 }; this._ap = function (a, j, d, g) { var c = this.image; var h = qrcode.height; var b = this._da; var f = a; while (f >= 0 && c[j + f * qrcode.width]) { b[2]++; f-- } if (f < 0) { return NaN } while (f >= 0 && !c[j + f * qrcode.width] && b[1] <= d) { b[1]++; f-- } if (f < 0 || b[1] > d) { return NaN } while (f >= 0 && c[j + f * qrcode.width] && b[0] <= d) { b[0]++; f-- } if (b[0] > d) { return NaN } f = a + 1; while (f < h && c[j + f * qrcode.width]) { b[2]++; f++ } if (f == h) { return NaN } while (f < h && !c[j + f * qrcode.width] && b[3] < d) { b[3]++; f++ } if (f == h || b[3] >= d) { return NaN } while (f < h && c[j + f * qrcode.width] && b[4] < d) { b[4]++; f++ } if (b[4] >= d) { return NaN } var e = b[0] + b[1] + b[2] + b[3] + b[4]; if (5 * Math.abs(e - g) >= 2 * g) { return NaN } return this._ao(b) ? this._an(b, f) : NaN }; this._ej = function (b, a, e, h) { var d = this.image; var i = qrcode.width; var c = this._da; var g = b; while (g >= 0 && d[g + a * qrcode.width]) { c[2]++; g-- } if (g < 0) { return NaN } while (g >= 0 && !d[g + a * qrcode.width] && c[1] <= e) { c[1]++; g-- } if (g < 0 || c[1] > e) { return NaN } while (g >= 0 && d[g + a * qrcode.width] && c[0] <= e) { c[0]++; g-- } if (c[0] > e) { return NaN } g = b + 1; while (g < i && d[g + a * qrcode.width]) { c[2]++; g++ } if (g == i) { return NaN } while (g < i && !d[g + a * qrcode.width] && c[3] < e) { c[3]++; g++ } if (g == i || c[3] >= e) { return NaN } while (g < i && d[g + a * qrcode.width] && c[4] < e) { c[4]++; g++ } if (c[4] >= e) { return NaN } var f = c[0] + c[1] + c[2] + c[3] + c[4]; if (5 * Math.abs(f - h) >= h) { return NaN } return this._ao(c) ? this._an(c, g) : NaN }; this._cu = function (c, f, e) { var d = c[0] + c[1] + c[2] + c[3] + c[4]; var n = this._an(c, e); var b = this._ap(f, Math.floor(n), c[2], d); if (!isNaN(b)) { n = this._ej(Math.floor(n), Math.floor(b), c[2], d); if (!isNaN(n)) { var l = d / 7; var m = false; var h = this._cv.length; for (var g = 0; g < h; g++) { var a = this._cv[g]; if (a._ev(l, b, n)) { a._ek(); m = true; break } } if (!m) { var k = new _cz(n, b, l); this._cv.push(k); if (this._am != null) { this._am._ep(k) } } return true } } return false }; this._ee = function () { var h = this._cv.length; if (h < 3) { throw "Couldn't find enough finder patterns (found " + h + ")" } if (h > 3) { var b = 0; var j = 0; for (var d = 0; d < h; d++) { var g = this._cv[d]._ei; b += g; j += (g * g) } var a = b / h; this._cv.sort(function (m, l) { var k = Math.abs(l._ei - a); var i = Math.abs(m._ei - a); if (k < i) { return (-1) } else { if (k == i) { return 0 } else { return 1 } } }); var e = Math.sqrt(j / h - a * a); var c = Math.max(0.2 * a, e); for (var d = this._cv.length - 1; d >= 0; d--) { var f = this._cv[d]; if (Math.abs(f._ei - a) > c) { this._cv.splice(d, 1) } } } if (this._cv.length > 3) { this._cv.sort(function (k, i) { if (k.count > i.count) { return -1 } if (k.count < i.count) { return 1 } return 0 }) } return new Array(this._cv[0], this._cv[1], this._cv[2]) }; this._eq = function () { var b = this._cv.length; if (b <= 1) { return 0 } var c = null; for (var d = 0; d < b; d++) { var a = this._cv[d]; if (a.Count >= _eg) { if (c == null) { c = a } else { this._ge = true; return Math.floor((Math.abs(c.X - a.X) - Math.abs(c.Y - a.Y)) / 2) } } } return 0 }; this._cx = function () { var g = 0; var c = 0; var a = this._cv.length; for (var d = 0; d < a; d++) { var f = this._cv[d]; if (f.Count >= _eg) { g++; c += f._ei } } if (g < 3) { return false } var e = c / a; var b = 0; for (var d = 0; d < a; d++) { f = this._cv[d]; b += Math.abs(f._ei - e) } return b <= 0.05 * c }; this._ce = function (e) { var o = false; this.image = e; var n = qrcode.height; var k = qrcode.width; var a = Math.floor((3 * n) / (4 * _eh)); if (a < _gf || o) { a = _gf } var g = false; var d = new Array(5); for (var h = a - 1; h < n && !g; h += a) { d[0] = 0; d[1] = 0; d[2] = 0; d[3] = 0; d[4] = 0; var b = 0; for (var f = 0; f < k; f++) { if (e[f + h * qrcode.width]) { if ((b & 1) == 1) { b++ } d[b]++ } else { if ((b & 1) == 0) { if (b == 4) { if (this._ao(d)) { var c = this._cu(d, h, f); if (c) { a = 2; if (this._ge) { g = this._cx() } else { var m = this._eq(); if (m > d[2]) { h += m - d[2] - a; f = k - 1 } } } else { do { f++ } while (f < k && !e[f + h * qrcode.width]); f-- } b = 0; d[0] = 0; d[1] = 0; d[2] = 0; d[3] = 0; d[4] = 0 } else { d[0] = d[2]; d[1] = d[3]; d[2] = d[4]; d[3] = 1; d[4] = 0; b = 3 } } else { d[++b]++ } } else { d[b]++ } } } if (this._ao(d)) { var c = this._cu(d, h, k); if (c) { a = d[0]; if (this._ge) { g = this._cx() } } } } var l = this._ee(); qrcode._er(l); return new _es(l) } } function _ai(c, a, b) { this.x = c; this.y = a; this.count = 1; this._aj = b; this.__defineGetter__("_ei", function () { return this._aj }); this.__defineGetter__("Count", function () { return this.count }); this.__defineGetter__("X", function () { return Math.floor(this.x) }); this.__defineGetter__("Y", function () { return Math.floor(this.y) }); this._ek = function () { this.count++ }; this._ev = function (f, e, d) { if (Math.abs(e - this.y) <= f && Math.abs(d - this.x) <= f) { var g = Math.abs(f - this._aj); return g <= 1 || g / this._aj <= 1 } return false } } function _ak(g, c, b, f, a, e, d) { this.image = g; this._cv = new Array(); this.startX = c; this.startY = b; this.width = f; this.height = a; this._ef = e; this._al = new Array(0, 0, 0); this._am = d; this._an = function (i, h) { return (h - i[2]) - i[1] / 2 }; this._ao = function (l) { var k = this._ef; var h = k / 2; for (var j = 0; j < 3; j++) { if (Math.abs(k - l[j]) >= h) { return false } } return true }; this._ap = function (h, q, l, o) { var k = this.image; var p = qrcode.height; var j = this._al; j[0] = 0; j[1] = 0; j[2] = 0; var n = h; while (n >= 0 && k[q + n * qrcode.width] && j[1] <= l) { j[1]++; n-- } if (n < 0 || j[1] > l) { return NaN } while (n >= 0 && !k[q + n * qrcode.width] && j[0] <= l) { j[0]++; n-- } if (j[0] > l) { return NaN } n = h + 1; while (n < p && k[q + n * qrcode.width] && j[1] <= l) { j[1]++; n++ } if (n == p || j[1] > l) { return NaN } while (n < p && !k[q + n * qrcode.width] && j[2] <= l) { j[2]++; n++ } if (j[2] > l) { return NaN } var m = j[0] + j[1] + j[2]; if (5 * Math.abs(m - o) >= 2 * o) { return NaN } return this._ao(j) ? this._an(j, n) : NaN }; this._cu = function (l, o, n) { var m = l[0] + l[1] + l[2]; var t = this._an(l, n); var k = this._ap(o, Math.floor(t), 2 * l[1], m); if (!isNaN(k)) { var s = (l[0] + l[1] + l[2]) / 3; var q = this._cv.length; for (var p = 0; p < q; p++) { var h = this._cv[p]; if (h._ev(s, k, t)) { return new _ai(t, k, s) } } var r = new _ai(t, k, s); this._cv.push(r); if (this._am != null) { this._am._ep(r) } } return null }; this.find = function () { var p = this.startX; var s = this.height; var q = p + f; var r = b + (s >> 1); var m = new Array(0, 0, 0); for (var k = 0; k < s; k++) { var o = r + ((k & 1) == 0 ? ((k + 1) >> 1) : -((k + 1) >> 1)); m[0] = 0; m[1] = 0; m[2] = 0; var n = p; while (n < q && !g[n + qrcode.width * o]) { n++ } var h = 0; while (n < q) { if (g[n + o * qrcode.width]) { if (h == 1) { m[h]++ } else { if (h == 2) { if (this._ao(m)) { var l = this._cu(m, o, n); if (l != null) { return l } } m[0] = m[2]; m[1] = 1; m[2] = 0; h = 1 } else { m[++h]++ } } } else { if (h == 1) { h++ } m[h]++ } n++ } if (this._ao(m)) { var l = this._cu(m, o, q); if (l != null) { return l } } } if (!(this._cv.length == 0)) { return this._cv[0] } throw "Couldn't find enough alignment patterns" } } function QRCodeDataBlockReader(c, a, b) { this._ed = 0; this._cw = 7; this.dataLength = 0; this.blocks = c; this._en = b; if (a <= 9) { this.dataLengthMode = 0 } else { if (a >= 10 && a <= 26) { this.dataLengthMode = 1 } else { if (a >= 27 && a <= 40) { this.dataLengthMode = 2 } } } this._gd = function (f) { var k = 0; if (f < this._cw + 1) { var m = 0; for (var e = 0; e < f; e++) { m += (1 << e) } m <<= (this._cw - f + 1); k = (this.blocks[this._ed] & m) >> (this._cw - f + 1); this._cw -= f; return k } else { if (f < this._cw + 1 + 8) { var j = 0; for (var e = 0; e < this._cw + 1; e++) { j += (1 << e) } k = (this.blocks[this._ed] & j) << (f - (this._cw + 1)); this._ed++; k += ((this.blocks[this._ed]) >> (8 - (f - (this._cw + 1)))); this._cw = this._cw - f % 8; if (this._cw < 0) { this._cw = 8 + this._cw } return k } else { if (f < this._cw + 1 + 16) { var j = 0; var h = 0; for (var e = 0; e < this._cw + 1; e++) { j += (1 << e) } var g = (this.blocks[this._ed] & j) << (f - (this._cw + 1)); this._ed++; var d = this.blocks[this._ed] << (f - (this._cw + 1 + 8)); this._ed++; for (var e = 0; e < f - (this._cw + 1 + 8); e++) { h += (1 << e) } h <<= 8 - (f - (this._cw + 1 + 8)); var l = (this.blocks[this._ed] & h) >> (8 - (f - (this._cw + 1 + 8))); k = g + d + l; this._cw = this._cw - (f - 8) % 8; if (this._cw < 0) { this._cw = 8 + this._cw } return k } else { return 0 } } } }; this.NextMode = function () { if ((this._ed > this.blocks.length - this._en - 2)) { return 0 } else { return this._gd(4) } }; this.getDataLength = function (d) { var e = 0; while (true) { if ((d >> e) == 1) { break } e++ } return this._gd(qrcode._eo[this.dataLengthMode][e]) }; this.getRomanAndFigureString = function (h) { var f = h; var g = 0; var j = ""; var d = new Array("0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z", " ", "$", "%", "*", "+", "-", ".", "/", ":"); do { if (f > 1) { g = this._gd(11); var i = Math.floor(g / 45); var e = g % 45; j += d[i]; j += d[e]; f -= 2 } else { if (f == 1) { g = this._gd(6); j += d[g]; f -= 1 } } } while (f > 0); return j }; this.getFigureString = function (f) { var d = f; var e = 0; var g = ""; do { if (d >= 3) { e = this._gd(10); if (e < 100) { g += "0" } if (e < 10) { g += "0" } d -= 3 } else { if (d == 2) { e = this._gd(7); if (e < 10) { g += "0" } d -= 2 } else { if (d == 1) { e = this._gd(4); d -= 1 } } } g += e } while (d > 0); return g }; this.get8bitByteArray = function (g) { var e = g; var f = 0; var d = new Array(); do { f = this._gd(8); d.push(f); e-- } while (e > 0); return d }; this.getKanjiString = function (j) { var g = j; var i = 0; var h = ""; do { i = this._gd(13); var e = i % 192; var f = i / 192; var k = (f << 8) + e; var d = 0; if (k + 33088 <= 40956) { d = k + 33088 } else { d = k + 49472 } h += String.fromCharCode(d); g-- } while (g > 0); return h }; this.parseECIValue = function () { var f = 0; var e = this._gd(8); if ((e & 128) == 0) { f = e & 127 } if ((e & 192) == 128) { var d = this._gd(8); f = ((e & 63) << 8) | d } if ((e & 224) == 192) { var g = this._gd(8); f = ((e & 31) << 16) | g } return f }; this.__defineGetter__("DataByte", function () { var h = new Array(); var e = 1; var f = 2; var d = 4; var n = 7; var p = 8; do { var l = this.NextMode(); if (l == 0) { if (h.length > 0) { break } else { throw "Empty data block" } } if (l != e && l != f && l != d && l != p && l != n) { throw "Invalid mode: " + l + " in (block:" + this._ed + " bit:" + this._cw + ")" } if (l == n) { var o = this.parseECIValue() } else { var g = this.getDataLength(l); if (g < 1) { throw "Invalid data length: " + g } switch (l) { case e: var m = this.getFigureString(g); var k = new Array(m.length); for (var i = 0; i < m.length; i++) { k[i] = m.charCodeAt(i) } h.push(k); break; case f: var m = this.getRomanAndFigureString(g); var k = new Array(m.length); for (var i = 0; i < m.length; i++) { k[i] = m.charCodeAt(i) } h.push(k); break; case d: var o = this.get8bitByteArray(g); h.push(o); break; case p: var m = this.getKanjiString(g); h.push(m); break } } } while (true); return h }) };

try {
    const secretkeys = GM_listValues();
    const allSaveKeyInputs = [];
    const msgdiv = addCss();
    createBtn('', 'add', 'add', add);

    createBtn('', 'save', 'save', function () {
        let allsecretkeys = {};
        for (let kn of secretkeys) {
            allsecretkeys[kn] = GM_getValue(kn);
        }
        var ks = JSON.stringify(allsecretkeys);
        const b = new File([ks], "2fa-key-bak.json", { type: "application/json" });
        var u = URL.createObjectURL(b);
        let a = document.createElement('a');
        a.href = u;
        a.setAttribute('download', "2fa-key-bak.json");
        a.click();
        delete a;
    });


    createBtn('', 'import', 'import', function () {
        let inf = importFile();
        inf.click();
    });

    const countdown = createText(':30', 30, 'time');
    br();
    for (let n of secretkeys) {
        let ctext = createText(n, n, 'btnlist', copyCode);
        allSaveKeyInputs.push(ctext);
        createBtn('', n, 'del', delKey);
        br();
    }

    updateCode();


    function addCss() {
        let style = document.createElement('style');
        style.innerHTML = '.-m2fa-it {height: 3rem;width: 20rem;font-size: 1.5rem;margin: 1rem;} .-m2fa-btn{height: 3rem;width: 6rem;font-size: 1.5rem;margin: 1rem .3rem;}';
        document.head.appendChild(style);
        //let sheet = style.sheet;
        //sheet.insertRule('.-m2fa-it {height: 3rem;width: 20rem;font-size: 1.5rem;margin: 1rem;}', 0);
        //sheet.insertRule('.-m2fa-btn{height: 3rem;width: 20rem;font-size: 1.5rem;margin: 1rem;}', 0);

        let msgdiv = document.createElement('div');
        msgdiv.id = 'msg';
        msgdiv.setAttribute('style', 'color: red; z-index: 1000;position: fixed;background-color: #FFF;width: 90%;text-align: center;top:0;font-size: 1.5rem;');
        document.body.appendChild(msgdiv);
        return msgdiv;
    }

    function msg(msg) {
        if (msg) {
            msgdiv.style.display = 'block';
            msgdiv.textContent = msg;
        } else {
            msgdiv.style.display = 'none';
        }
    }
    function hint(ele, msg) {
        if (msg) {
            ele.style.border = '1px solid red';
            ele.nextElementSibling.textContent = msg;
        } else {
            ele.removeAttribute('style');
            ele.nextElementSibling.textContent = '';
        }
    }
    function add() {
        let box = document.createElement('div');
        box.id = 'add-box';
        box.innerHTML = '<div style="background-color: #FFF;width: 25rem;margin: 5rem auto;">'
            + '<input type="text" placeholder="" class="-m2fa-it"><span style="color:red;"></span><br/>'
            + '<textarea type="text" placeholder="" class="-m2fa-it" style="height:7rem;"></textarea><span style="color:red;">></span><br/>'
            + '<input type="text" placeholder="" class="-m2fa-it" readonly><br/>'
            + '<button class="-m2fa-btn"></button>'
            + '<button class="-m2fa-btn"></button>'
            + '<button class="-m2fa-btn" style="width:7rem;"></button>'
            + '<br/></div>';
        box.setAttribute('style', 'position: absolute;z-index:100;height:100%;width:100%;top: 0;left: 0;background-color: rgba(3,3,3,0.8);');
        document.body.appendChild(box);
        let btns = box.getElementsByTagName('button');
        let inpts = box.getElementsByTagName('input');
        let secretInput = box.getElementsByTagName('textarea');
        btns[0].addEventListener('click', function () {
            let secret = secretInput[0].value;
            if (secret.length <= 5) {
                hint(secretInput[0], '');
                return;
            }
            let name = inpts[0].value;
            if (name.length <= 2) {
                hint(inpts[0], '');
                return;
            }
            GM_setValue(name, secret);
            document.body.removeChild(box);
            window.location.reload();
        });
        btns[1].addEventListener('click', function () {
            document.body.removeChild(box);
            msgdiv.setAttribute('data-hidden', 'none');
        });
        btns[2].addEventListener('click', function () {
            let i = document.createElement('input');
            i.setAttribute('type', "file");
            i.setAttribute('accept', 'image/*');
            i.setAttribute('capture', 'environment');
            i.setAttribute('style', 'opacity: 0;display: inline;position: absolute;');
            document.body.appendChild(i);
            i.click();
            i.addEventListener("change", function () {
                let f = this.files[0];
                let u = URL.createObjectURL(f);
                qrcode.decode(u);
                qrcode.callback = function (imgMsg) {
                    if(imgMsg.indexOf('otpauth://') === 0) {
                        let u = new URL(imgMsg);
                        let issuer = u.searchParams.get('issuer');
                        if(issuer) {
                            inpts[0].value = issuer;
                        }
                        inpts[0].value = decodeURIComponent(u.pathname.slice(2).split('/')[1]);
                    }
                    secretInput[0].value = imgMsg;
                    whenInputGetCode(inpts[1], secretInput[0]);
                }
            }, false);
        });

        inpts[0].addEventListener('input', function () {
            if (secretkeys.indexOf(this.value) >= 0) {
                hint(inpts[0], ',');
            } else {
                hint(inpts[0], 0);
            }
        });
        secretInput[0].addEventListener('input', function () {
            hint(secretInput[0], 0);
            whenInputGetCode(inpts[1], this);
        });
        return;
    }
    function whenInputGetCode(codeInput, obj) {
        let s = getLastSecond();
        let code = getCodeJS(obj.value);
        codeInput.value = code;
        msg(':' + s);
        msgdiv.setAttribute('data-hidden', 'show');
        let addInter = setInterval(function () {
            if (msgdiv.getAttribute('data-hidden') == 'none') {
                clearInterval(addInter);
                msg('');
                return;
            }
            let code = getCodeJS(obj.value);
            codeInput.value = code;
            s = getLastSecond();
            msg(':' + s);
        }, 1000);

    }
    function getCodeJS(secret) {
        try {
            let secretKey = secret;
            let algorithm = 'SHA1';
            let digits = 6;
            let period = 30;
            if (secret.indexOf('otpauth://') === 0) {
                let url = new URL(secret);
                secretKey = url.searchParams.get('secret');
                algorithm = url.searchParams.get('algorithm')||algorithm;
                digits = url.searchParams.get('digits')||digits;
                period = url.searchParams.get('period')||period;
            }
            const totp = new OTPAuth.TOTP({
                algorithm: algorithm,
                digits: digits,
                period: period,
                secret: OTPAuth.Secret.fromBase32(secretKey)
            });
            return totp.generate();
        } catch (err) {
            msg(err.message);
        }
    }

    function createBtn(label, name, flag, click) {
        let btn = document.createElement('button');
        btn.textContent = label;
        btn.addEventListener('click', click);
        btn.name = name;
        btn.className = flag + ' -m2fa-btn';
        document.body.appendChild(btn);
        return btn;
    }
    function createText(label, name, flag, click) {
        let btn = document.createElement('input');
        btn.type = 'text';
        btn.value = label;
        btn.addEventListener('click', click);
        btn.name = name;
        btn.className = flag + ' -m2fa-it';
        btn.setAttribute('readonly', true);
        document.body.appendChild(btn);
        return btn;
    }
    function br() {
        let br = document.createElement('br');
        document.body.appendChild(br);
    }
    function copyCode() {
        let code = this.title;
        GM_setClipboard(code, 'text');
        prompt(':', code);
    }
    function delKey() {
        let key = this.name;
        if (confirm('' + key + '?')) {
            GM_deleteValue(key);
            window.location.reload();
        }
    }
    function getLastSecond() {
        let period = 30;
        return (period * (1 - ((Date.now() / 1000 / period) % 1))) | 0;
    }

    function updateCode() {
        setInterval(function () {
            let lt = getLastSecond();
            countdown.value = ':' + lt;
            for (let key of allSaveKeyInputs) {
                let secret = GM_getValue(key.name)
                let code = getCodeJS(secret);
                key.title = code;
                key.value = key.name + ':' + code;
            }
        }, 1000);
    }

    function importFile() {
        let i = document.createElement('input');
        i.setAttribute('type', "file");
        i.setAttribute('style', 'opacity: 0;display: inline;position: absolute;');
        document.body.appendChild(i);
        i.addEventListener("change", function () {
            let f = this.files[0];
            const reader = new FileReader();
            reader.addEventListener("load", () => {
                let data = JSON.parse(reader.result);
                for (let ik of Object.entries(data)) {
                    GM_setValue(ik[0], ik[1]);
                }
                window.location.reload();
            }, false,);
            reader.readAsText(f);
        }, false);
        return i;
    }
} catch (err) {
    console.error(err);
}